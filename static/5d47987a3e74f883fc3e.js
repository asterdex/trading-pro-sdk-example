"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[7357],{57357:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ge});var s=i(76398),r=i(58138),n=i(51485),a=i(72249),o=i(96832),l=i(74958),d=i(27008),c=i(19805),m=i(71007),x=i(87795),h=i(88723),u=i(53066),y=i(62600),p=i(67590),f=i(82373),g=i(49247);const b=o.memo((({hideOtherPairs:e,onHideOtherPairs:t,mHeaderText:i,hideName:s})=>(0,r.jsx)("div",Object.assign({className:"action-bar"},{children:(0,r.jsxs)(a.Z,Object.assign({sx:{alignItems:"center",color:"t.third"},onClick:()=>t(!e)},{children:[(0,r.jsx)(f.Z,{name:s,checked:e,onChange:()=>!1}),(0,r.jsx)(g.Z,Object.assign({variant:"caption",sx:{userSelect:"none"}},{children:i}))]}))})))),j=e=>(0,c.ZK)("trd-tradeHistory",e);var O=i(31677),T=i(40721),P=i(71882),v=i(17776),w=i(89865),S=i(12560),k=i(54813),M=i(31050);function N(e,t,i={}){const{tickSize:s,minQty:r,equalQtyPrecision:n}=i,a=(0,M.M)(String(t)),o=s?(0,k.pC)(+s):a,l=r?(0,k.pC)(+r):a;switch(e.toLowerCase()){case"fee":case"total":return(0,k.uf)(t,8);case"filled":return(0,k.uf)(t,l);case"equalqty":return(0,k.mD)(+t,n);case"totalquota":return(0,k.mD)(+t,o);case"price":return(0,k.uf)(t,o);default:return e}}const Z=(0,S.nM)(),I=e=>Z?(({symbol:e,insertTime:t,side:i,positionSide:s="BOTH",price:r,qty:n,totalQuota:a,fee:o,commissionAsset:l,realizedProfit:d})=>{const m=((0,v.Vh)()||{})[e]||{},{marginAsset:x,pricePrecision:h}=m,{getI18n:u}=j(),{getI18n:y}=(0,c.yk)(),p=y("Cont",{defaultValue:"Cont"}),{isCoinUnit:f}=(0,w.Q)();let g,b=e;return m&&(g=(0,O.H)(m,y),b=g.shortName),{nextDate:(0,T.v)(new Date(t),"yyyy-MM-dd hh:mm:ss"),nextPair:b,symbolName:g,nextSide:"BUY"===i?{color:"buy",children:u(`sideBuy${s}`,{defaultValue:"Buy"})}:{color:"sell",children:u(`sideSell${s}`,{defaultValue:"Sell"})},nextPrice:(0,P.uf)(r,h),nextQty:f?`${N("equalQty",a,m)} ${x}`:`${N("filled",n,m)} ${p}`,nextFee:`${N("fee",o,m)}\n              ${l||x}`,nextProfit:`${N("fee",d,m)}\n              ${x}`}})(e):(({symbol:e,insertTime:t,side:i,positionSide:s="BOTH",price:r,qty:n,totalQuota:a,fee:o,commissionAsset:l,realizedProfit:d})=>{const m=((0,v.Vh)()||{})[e]||{},{baseAsset:x,marginAsset:h,pricePrecision:u}=m,{getI18n:y}=j(),{getI18n:p}=(0,c.yk)(),{isCoinUnit:f}=(0,w.Q)();let g,b=e;return m&&(g=(0,O.H)(m,p),b=g.shortName),{nextDate:(0,T.v)(new Date(t),"yyyy-MM-dd hh:mm:ss"),nextPair:b,symbolName:g,nextSide:"BUY"===i?{color:"buy",children:y(`sideBuy${s}`,{defaultValue:"Buy"})}:{color:"sell",children:y(`sideSell${s}`,{defaultValue:"Sell"})},nextPrice:(0,P.uf)(r,u),nextQty:f?`${N("filled",n,m)} ${x}`:`${N("totalQuota",a,m)} ${h}`,nextFee:`${N("fee",o,m)}\n              ${l||h}`,nextProfit:`${N("fee",d,m)}\n                ${h}`}})(e),C=[{key:"price",text:"Price",i18n:"price",valueKey:"nextPrice"},{key:"quantity",text:"Quantity",i18n:"quantity",valueKey:"nextQty"},{key:"fee",text:"Fee",i18n:"fee",valueKey:"nextFee"},{key:"profit",text:"Realized Profit",i18n:"realizedProfit",valueKey:"nextProfit"},{key:"time",text:"Time",i18n:"time",valueKey:"nextDate"}],H=({children:e})=>(0,r.jsx)(g.Z,Object.assign({variant:"caption",__css:{color:"t.third"}},{children:e})),$=e=>{var{color:t="t.primary"}=e,i=(0,s._T)(e,["color"]);return(0,r.jsx)(g.Z,Object.assign({variant:"captionSub",color:t},i))},z=({children:e,sx:t})=>(0,r.jsx)(a.Z,Object.assign({className:"row-item",sx:t},{children:e})),_=({symbolName:e,nextPair:t,nextSide:i})=>(0,r.jsx)(z,Object.assign({sx:{pb:"10px !important"}},{children:(0,r.jsxs)("div",Object.assign({className:"symbol-wrap"},{children:[e?(0,r.jsxs)("div",Object.assign({className:"symbolText"},{children:[(0,r.jsx)("div",Object.assign({className:"symbol"},{children:e.symbol})),(0,r.jsx)("div",{children:`${e.contractTypeI18n} ${e.deliveryDateFormat}`})]})):(0,r.jsx)("div",Object.assign({className:"symbolText"},{children:t})),(0,r.jsx)(g.Z,Object.assign({variant:"caption"},i))]}))})),D=o.memo((e=>{const{getI18n:t}=j(),i=I(e),s=C,{symbolName:n,nextPair:a,nextSide:o}=i;return(0,r.jsxs)("div",Object.assign({className:"row-wrap"},{children:[(0,r.jsx)(_,{symbolName:n,nextSide:o,nextPair:a}),s.map((({key:e,text:s,i18n:n,valueKey:a})=>(0,r.jsxs)(z,{children:[(0,r.jsx)(H,{children:t(n,{defaultValue:s})}),(0,r.jsx)($,{children:i[a]})]},e)))]}))})),F=o.memo((e=>{const{getI18n:t}=j(),i=I(e),{symbolName:s,nextPair:n,nextSide:a}=i;return(0,r.jsxs)("div",Object.assign({className:"row-wrap"},{children:[(0,r.jsx)(_,{symbolName:s,nextSide:a,nextPair:n}),(0,r.jsx)("div",Object.assign({className:"row-grid"},{children:C.map((({key:e,text:s,i18n:n,valueKey:a})=>(0,r.jsxs)("div",Object.assign({className:a},{children:[(0,r.jsx)(H,{children:t(n,{defaultValue:s})}),(0,r.jsx)($,{children:i[a]})]}),e)))}))]}))}));var B=i(11204),Q=i(83045),W=i(37375);const E=S.K3.tradehistory,V=({hideOtherPairs:e,onHideOtherPairs:t,hideText:i,hideName:s})=>{const{isMobile:n}=(0,c.Fs)();return(0,r.jsxs)(a.Z,Object.assign({sx:{alignItems:"center",fontSize:[1,0],color:"t.third",userSelect:"none",position:"absolute",top:"-40px",right:"28px",zIndex:"999",height:"40px"},onClick:()=>t(!e)},{children:[(0,r.jsx)(f.Z,{name:s,size:n?18:16,checked:e,onChange:()=>!1}),(0,r.jsx)(g.Z,Object.assign({sx:{lineHeight:1}},{children:i}))]}))},q=({type:e,endTime:t,startTime:i,onSearch:s,hideOtherPairs:n,onHideOtherPairs:o,hideText:l,hideName:d})=>{const{isMobile:m,isIPad:x}=(0,c.Fs)(),{getI18n:h}=(0,c.Vw)(),u="number"==typeof t&&"number"==typeof i;return m?(0,r.jsx)(W.Z,{onSearch:s}):(0,r.jsxs)(a.Z,Object.assign({sx:{alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",height:"32px",pb:"10px"}},{children:[(0,r.jsx)(Q.Z,{type:e,onSearch:s}),!m&&!x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(V,{hideOtherPairs:n,onHideOtherPairs:o,hideText:l,hideName:d}),u&&(0,r.jsx)(B.Z,{dateTime:{startTime:i,endTime:t},downloadUrl:E.uri,title:h(E.key)})]})]}))},A={position:"relative",flexDirection:"column",flex:"1 0",".action-bar":{display:"flex",alignItems:"center",height:32,pt:10},".empty":{display:"flex",minHeight:120,alignItems:"center",justifyContent:"center",color:"t.secondary",fontSize:0},".row-wrap":{color:"t.primary",py:15,borderBottom:"1px solid",borderColor:"line","&:last-of-type":{mb:102,borderBottom:"none"},"& .row-item":{justifyContent:"space-between",alignItems:"center",py:"minor"},"& .symbol-wrap":{display:"flex",flexDirection:"column",fontSize:0,"& .symbolText":{display:"flex",alignItems:"center"},"& .symbol":{mr:"minor",fontSize:1,fontWeight:"medium"}}}},R={position:"relative",flexDirection:"column",height:"100%",".action-bar":{display:"flex",alignItems:"center",height:32,pb:10},".empty":{display:"flex",minHeight:120,alignItems:"center",justifyContent:"center",color:"t.secondary",fontSize:0},".row-list":{height:"calc(100% - 32px)",overflow:"auto","&::-webkit-scrollbar":{display:"none"},"&::-webkit-scrollbar-thumb":{bg:"transparent"}},".row-wrap":{color:"t.primary",py:15,borderBottom:"1px solid",borderColor:"line","&:last-of-type":{mb:15,borderBottom:"none"},".row-grid":{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(2, 1fr)",gridGap:"12px 16px",gridTemplateAreas:'"nextPrice nextQty nextFee"\n        "nextProfit nextDate ."',"& .nextFee":{textAlign:"right"}},"& .row-item":{justifyContent:"space-between",alignItems:"center"},"& .symbol-wrap":{display:"flex",alignItems:"center",fontSize:0,"& .symbolText":{display:"flex",alignItems:"center",mr:"xs"},"& .symbol":{mr:"minor",fontSize:1,fontWeight:"medium"}}}},K=()=>{const{getI18n:e}=j();return(0,r.jsx)("div",Object.assign({className:"empty"},{children:e("nodata",{defaultValue:"You have no trades."})}))},G=o.memo((({isMobile:e,isEmpty:t,hasMore:i,loadMore:s,loading:n,data:l=[],hideOtherPairs:d,onHideOtherPairs:c,hideName:m,mHeaderText:x,hideText:h,onSearch:u,filterType:f})=>((0,o.useEffect)((()=>{i&&s()}),[i,s]),(0,r.jsxs)(a.Z,Object.assign({sx:e?A:R},{children:[(0,r.jsx)(y.Z,{fullScreen:!0,show:n}),(0,r.jsx)(b,{hideOtherPairs:d,onHideOtherPairs:c,mHeaderText:x,hideName:m}),(0,r.jsx)(q,{type:f,onSearch:u,hideOtherPairs:d,onHideOtherPairs:c,hideText:h,hideName:m}),t?(0,r.jsx)(K,{}):e?l.map((e=>(0,r.jsx)(D,Object.assign({},e),e.tradeId))):(0,r.jsx)("div",Object.assign({className:"row-list"},{children:l.map((e=>(0,r.jsx)(F,Object.assign({},e),e.tradeId)))})),i&&(0,r.jsx)(p.Z,{showMore:s,check:{offset:200},loading:n})]})))));var U=i(86282),Y=i(60037);const L={my:0,py:"xs",width:"calc(100% - 5px)",display:"flex",alignItems:"center",flexGrow:0,flexShrink:0,color:"t.third",fontSize:[0],cursor:"auto"},X={userSelect:"none",px:"xs",flexGrow:1,fontWeight:"normal",whiteSpace:"nowrap"},J={time:{minWidth:"120px"},symbol:{color:"t.secondary",minWidth:"90px"},side:{minWidth:"30px"},price:{color:"t.secondary",minWidth:"75px"},quantity:{color:"t.secondary",minWidth:"75px"},fee:{color:"t.secondary",minWidth:"110px"},profit:{color:"t.secondary",minWidth:"125px"}},ee=e=>{const t=J[e]||{};return Object.assign(Object.assign(Object.assign({},X),t),{flexBasis:t.minWidth})},te=e=>(0,r.jsx)(g.Z,Object.assign({},e)),ie=o.memo((e=>{var{useColumn:t}=e,i=(0,s._T)(e,["useColumn"]);const n=t(i),{symbol:o}=i,{nextDate:l,symbolName:d,nextSide:c,nextPrice:m,nextQty:x,nextFee:h,nextProfit:u}=n;return(0,r.jsxs)(a.Z,Object.assign({sx:Object.assign(Object.assign({},L),{color:"t.secondary",fontSize:[0],cursor:"auto",py:0,width:"100%",height:"100%",":hover":{backgroundColor:"bg3",".symbol":{color:"t.yellow"}}})},{children:[(0,r.jsx)(g.Z,Object.assign({sx:Object.assign({color:"table.timeColor"},ee("time"))},{children:l})),(0,r.jsx)(g.Z,Object.assign({sx:ee("symbol"),className:"symbol"},{children:(0,r.jsx)(Y.O,{symbolName:d,fallbackText:o})})),(0,r.jsx)(g.Z,Object.assign({},c,{sx:ee("side")})),(0,r.jsx)(te,Object.assign({sx:ee("price")},{children:m})),(0,r.jsx)(te,Object.assign({sx:ee("quantity")},{children:x})),(0,r.jsx)(g.Z,Object.assign({sx:ee("fee")},{children:h})),(0,r.jsx)(te,Object.assign({sx:ee("profit")},{children:u}))]}))}));var se=i(96056),re=i(35728);const ne=o.memo((({loading:e=!1,data:t,renderRow:i,empty:s,isEmpty:n,hasMore:a,loadMore:l,rowHeight:d=80,minWidth:c=0,sx:m})=>{const x=(0,o.useRef)({data:t,flag:-1});x.current.data!==t&&(x.current.flag*=-1),x.current.data=t;const h=(0,o.useRef)(null);(0,o.useEffect)((()=>{if(!h.current)return;const{listRef:e}=h.current;if(!e||!e.current)return;const{current:t}=e;t.resetAfterIndex(0,!0)}),[x.current.flag]);const u=(0,o.useMemo)((()=>[{title:"",dataIndex:"",hideTitle:!0,render:i}]),[i]);return n?(0,r.jsx)(o.Fragment,{children:s}):(0,r.jsxs)(U.Z,Object.assign({sx:Object.assign({position:"relative",".list-grid":{width:"100%","> div > div":{border:0,"> div":{my:0,px:0,height:"100%",borderBottom:"1px solid",borderBottomColor:"newLine"},"> div > div":{height:"100%"}}}},m)},{children:[(0,r.jsx)(y.Z,{fullScreen:!0,inner:!0,show:e}),(0,r.jsx)(se.ZP,{children:({height:e,width:i})=>(0,r.jsx)(re.Z,{threshold:5,hasMore:a,loadMore:l,className:"list-grid",columns:u,ref:h,data:t,listGridConfig:{collapseHeight:d,height:Math.max(e-4,0),width:Math.max(i,c)},__hackDataChanged:x.current.flag})})]}))})),ae=[{key:"time",text:"Time",i18n:"time"},{key:"symbol",text:"Symbol",i18n:"symbol"},{key:"side",text:"Side",i18n:"side"},{key:"price",text:"Price",i18n:"price"},{key:"quantity",text:"Quantity",i18n:"quantity"},{key:"fee",text:"Fee",i18n:"fee"},{key:"profit",text:"Realized Profit",i18n:"realizedProfit"}],oe=(e,t)=>(0,r.jsx)(ie,Object.assign({},t,{useColumn:I})),le=()=>{const{getI18n:e}=j();return(0,r.jsx)(U.Z,Object.assign({sx:{color:"t.secondary",textAlign:"center",fontSize:[0],marginTop:"xs"}},{children:e("nodata",{defaultValue:"You have no trades."})}))},de=o.forwardRef((({isEmpty:e,hasMore:t,loadMore:i,loading:s,data:n=[]},l)=>{const{getI18n:d}=j(),c=(0,o.useMemo)((()=>(0,r.jsx)(a.Z,Object.assign({sx:Object.assign(Object.assign({},L),{borderBottom:"1px solid",borderBottomColor:"newLine"})},{children:ae.map((e=>{const{key:t,i18n:i,text:s}=e||{},n=d(i,{defaultValue:s});return(0,r.jsx)(U.Z,Object.assign({sx:ee(t)},{children:(0,r.jsx)(g.Z,Object.assign({sx:{fontSize:0,color:"t.third"}},{children:n}))}),t)}))}))),[d]);return(0,r.jsxs)(a.Z,Object.assign({ref:l,sx:{flexDirection:"column",flex:"1 0",overflowX:"auto"}},{children:[c,(0,r.jsx)(ne,{sx:{flex:"1 0"},loading:s,rowHeight:40,renderRow:oe,data:n,hasMore:t,loadMore:i,isEmpty:e,empty:(0,r.jsx)(le,{}),minWidth:Object.keys(J).reduce(((e,t)=>e+parseInt(J[t].minWidth,10)),0)})]}))})),ce=o.memo((({filterType:e,onSearch:t,hideOtherPairs:i,onHideOtherPairs:s,hasMore:n,loadMore:a,isEmpty:l,data:d,loading:c,currentPage:m,hideText:x,hideName:h,endTime:u,startTime:y})=>{const p=function(e){const t=(0,o.useRef)(null);return(0,o.useEffect)((()=>{if(1!==e)return;const{current:i}=t;if(i&&i instanceof Element){const e=i.querySelector(".list-grid");e&&(e.scrollTop=0)}})),t}(m);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U.Z,Object.assign({sx:{position:"relative"}},{children:(0,r.jsx)(q,{type:e,endTime:u,startTime:y,onSearch:t,hideOtherPairs:i,onHideOtherPairs:s,hideText:x,hideName:h})})),(0,r.jsx)(de,{ref:p,"data-testid":"tradeInfoTable",hasMore:n,loadMore:a,isEmpty:l,data:d,loading:c})]})})),me="UpdateFilter",xe="FetchSuccess",he={nextPage:1,hasMore:!0,filters:{l_pair:!1,timePeriod:"1w",startTime:0,endTime:0},items:[],symbolMap:{}},ue=(0,h.j)({[me](e,t){const{startTime:i,endTime:s,timePeriod:r,pair:n}=t.payload;void 0!==r&&(e.filters.timePeriod=r),void 0!==i&&(e.filters.startTime=i),void 0!==s&&(e.filters.endTime=s),void 0!==n&&(e.filters.l_pair=n)},[xe](e,t){const{data:i,page:s,total:r}=t.payload;1===s?e.items=i:i.length&&(e.items=e.items.concat(i)),e.hasMore=200*s<r,e.nextPage=s+1}},he),ye=(0,u.Z)(me),pe=(0,u.Z)(xe);function fe(e){let t=(0,x.OQ)(e.timePeriod);return t||(t={type:"1w",startTime:e.startTime,endTime:e.endTime}),t}const ge=o.memo((()=>{const{getI18n:e}=(0,c.yk)(),t="hideOtherSymbol",i=e(t,{defaultValue:"Hide Other Symbol"}),h=(0,l.I0)(),{isTradeHideOtherPairs:u}=(0,m.VX)(),{isMobile:y,isIPad:p}=(0,c.Fs)();he.filters.timePeriod=p?"1w":"1d",he.filters.l_pair=u;const f=(0,m.AM)(),[g,b]=(0,o.useReducer)(ue,Object.assign(Object.assign({},he),{symbolMap:f})),{nextPage:j,filters:O,hasMore:T}=g,{startTime:P,endTime:v}=fe(O),w=function(e,{pair:t}){const[i]=(0,m.z4)();let s;return(0,x.I9)(e,"insertTime"),t&&(s=e.filter((e=>e.symbol===i))),s||e}(g.items,{pair:O.l_pair}),S=(0,o.useCallback)((e=>{b(ye({pair:e})),h.userProfile.save({key:"isTradeHideOtherPairs",value:e})}),[h.userProfile]),[{loading:k},M]=(0,d.Z)((({page:e=j,times:t}={})=>(0,s.mG)(void 0,void 0,void 0,(function*(){const{startTime:i,endTime:r}=t||fe(O);if(null===i||null===r)return;const{data:a,total:o}=yield(({startTime:e,endTime:t,rows:i,page:r,accountType:a}={})=>(0,s.mG)(void 0,void 0,void 0,(function*(){let s;try{s=yield(0,n.v_)("/bapi/futures/v1/private/future/user-data/trade-history",{accountType:a,startTime:e,endTime:t,page:r,rows:i})}catch(e){throw new Error("nework error")}if("000000"!==s.code)throw new Error(s.message||"unknown error");return{data:s.data||[],total:s.total}})))({startTime:i,endTime:r,page:e,rows:200,accountType:"MAIN"});b(pe({data:a,total:o,page:e}))}))),[j,O],{loading:!0}),N=(0,o.useCallback)((({type:e,startTime:t,endTime:i})=>{b(ye({timePeriod:e,startTime:t,endTime:i})),M({page:1,times:{startTime:t,endTime:i}})}),[M]);(0,o.useEffect)((()=>{T||N((0,x.OQ)("1d"))}),[]);const Z=(0,o.useCallback)((()=>M()),[M]),I=!k&&w.length<=0;return(0,r.jsx)(a.Z,Object.assign({"data-testid":"DataTable",sx:{flexDirection:"column",height:"100%",pb:"xs",px:"sm"}},{children:p?(0,r.jsx)(G,{isMobile:y,hideOtherPairs:O.l_pair,onHideOtherPairs:S,hasMore:T,loadMore:Z,isEmpty:I,data:w,loading:k,hideName:t,mHeaderText:i,filterType:O.timePeriod,hideText:i,onSearch:N}):(0,r.jsx)(ce,{filterType:O.timePeriod,onSearch:N,hideOtherPairs:O.l_pair,onHideOtherPairs:S,hasMore:T,loadMore:Z,isEmpty:I,data:w,loading:k,currentPage:j-1,hideText:i,hideName:t,endTime:v,startTime:P})}))}))},60037:(e,t,i)=>{i.d(t,{O:()=>o});var s=i(76398),r=i(58138),n=i(86282);const a={display:"flex",flexDirection:"column",".pair":{fontWeight:"semibold"},".extra":{fontWeight:"normal"}},o=e=>{var{symbolName:t,fallbackText:i=""}=e,o=(0,s._T)(e,["symbolName","fallbackText"]);return(0,r.jsx)(n.Z,Object.assign({__css:a},o,{children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",Object.assign({className:"pair"},{children:t.symbol})),(0,r.jsx)("div",Object.assign({className:"extra"},{children:`${t.contractTypeI18n} ${t.deliveryDateFormat}`}))," "]}):i}))}},88723:(e,t,i)=>{i.d(t,{j:()=>n});var s=i(14035),r=i(25048);const n=(e,t)=>(0,s.Z)(Object.keys(e).reduce(((t,i)=>Object.assign(Object.assign({},t),{[i]:(t,s)=>(0,r.ZP)(t,(t=>e[i](t,s)))})),{}),t)}}]);