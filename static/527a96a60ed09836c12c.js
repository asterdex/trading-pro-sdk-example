"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[3557],{33557:(t,e,n)=>{n.d(e,{X:()=>h});var a=n(76398),i=n(96832),s=n(67284),p=n.n(s),u=n(25941),o=n(17921),r=n(10134);const y=[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1",type:"uint256"},{indexed:!0,internalType:"address",name:"to",type:"address"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0In",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1In",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount0Out",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1Out",type:"uint256"},{indexed:!0,internalType:"address",name:"to",type:"address"}],name:"Swap",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint112",name:"reserve0",type:"uint112"},{indexed:!1,internalType:"uint112",name:"reserve1",type:"uint112"}],name:"Sync",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{constant:!0,inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"MINIMUM_LIQUIDITY",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"}],name:"burn",outputs:[{internalType:"uint256",name:"amount0",type:"uint256"},{internalType:"uint256",name:"amount1",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getReserves",outputs:[{internalType:"uint112",name:"_reserve0",type:"uint112"},{internalType:"uint112",name:"_reserve1",type:"uint112"},{internalType:"uint32",name:"_blockTimestampLast",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_token0",type:"address"},{internalType:"address",name:"_token1",type:"address"}],name:"initialize",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"kLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"}],name:"mint",outputs:[{internalType:"uint256",name:"liquidity",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"price0CumulativeLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"price1CumulativeLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"}],name:"skim",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"amount0Out",type:"uint256"},{internalType:"uint256",name:"amount1Out",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"swap",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"sync",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"token0",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"token1",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"}],l=[{constant:!1,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"pure",type:"function"}],d=r.Mt;var m=n(59712);class c{constructor(t,e,n,a){this.isUniswapV3=!1,this.web3=new(p())((t=>{switch(t){case"eth":return"https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161";case"arb":return"https://arb1.arbitrum.io/rpc";case"base":return"https://mainnet.base.org/";default:return"https://bsc-dataseed1.defibit.io"}})(t)),this.pair=e,this.base=n,this.quote=a}init(){return(0,a.mG)(this,void 0,void 0,(function*(){yield Promise.all([this.initLPContract(this.pair),this.initUniswapV3PoolContract(this.pair),this.initBaseContract(this.base),this.initQuoteContract(this.quote)]).catch((t=>{m.error(t)})),yield this.detectUniswapVersion()}))}fetchPrice(){return(0,a.mG)(this,void 0,void 0,(function*(){return this.isUniswapV3?this.fetchUniswapV3Price():this.fetchUniswapV2Price()}))}detectUniswapVersion(){return(0,a.mG)(this,void 0,void 0,(function*(){try{yield this.uniswapV3PoolContract.methods.slot0().call(),this.isUniswapV3=!0}catch(t){this.isUniswapV3=!1}}))}initLPContract(t){return(0,a.mG)(this,void 0,void 0,(function*(){this.lpContract=new this.web3.eth.Contract(y,t)}))}initUniswapV3PoolContract(t){return(0,a.mG)(this,void 0,void 0,(function*(){this.uniswapV3PoolContract=new this.web3.eth.Contract(d,t)}))}initBaseContract(t){return(0,a.mG)(this,void 0,void 0,(function*(){this.baseContract=new this.web3.eth.Contract(l,t)}))}initQuoteContract(t){return(0,a.mG)(this,void 0,void 0,(function*(){this.quoteContract=new this.web3.eth.Contract(l,t)}))}fetchUniswapV2Price(){return(0,a.mG)(this,void 0,void 0,(function*(){const[{_reserve0:t,_reserve1:e},n,a,i,s]=yield Promise.all([this.lpContract.methods.getReserves().call(),this.lpContract.methods.token0().call(),this.lpContract.methods.token1().call(),this.baseContract.methods.decimals().call(),this.quoteContract.methods.decimals().call()]),p=Number(i),r=Number(s),y=Number((0,u.fromWei)(n.toLowerCase()===this.quote.toLowerCase()?t:e,"ether")),l=Number((0,u.fromWei)(a.toLowerCase()===this.base.toLowerCase()?e:t,"ether"));let d=new o.Z(l),m=new o.Z(y);return p!==r&&(d=d.div(new o.Z(Math.pow(10,p))),m=m.div(new o.Z(Math.pow(10,r)))),0===l?0:m.div(d).toNumber()}))}fetchUniswapV3Price(){return(0,a.mG)(this,void 0,void 0,(function*(){const[{sqrtPriceX96:t},e,n,a]=yield Promise.all([this.uniswapV3PoolContract.methods.slot0().call(),this.uniswapV3PoolContract.methods.token0().call(),this.baseContract.methods.decimals().call(),this.quoteContract.methods.decimals().call()]),i=new o.Z(t).pow(2).dividedBy(new o.Z(2).pow(192)),s=e.toLowerCase()===this.base.toLowerCase();return i.pow(s?1:-1).multipliedBy(new o.Z(10).pow(Number(n)-Number(a))).toNumber()}))}}var b=n(59712);const h=({tokenNetwork:t="bnb",pair:e,base:n,quote:s})=>{const[p,u]=(0,i.useState)(null),[o,r]=(0,i.useState)(0),y=(0,i.useCallback)((()=>(0,a.mG)(void 0,void 0,void 0,(function*(){if(p)try{const t=yield p.fetchPrice();r(t)}catch(t){b.error(t)}}))),[p]);return(0,i.useEffect)((()=>{(0,a.mG)(void 0,void 0,void 0,(function*(){const a=new c(t,e,n,s);yield a.init(),u(a)}))}),[e,n,s,t]),(0,i.useEffect)((()=>{y();const t=setInterval(y,3e5);return()=>clearInterval(t)}),[y]),o}}}]);