"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[8665],{24598:(e,t,r)=>{r.d(t,{Q:()=>o});var i=r(88673),n=r(81841);const{coin:s,cont:a}=i.coinFuturesUnit;function o(){const{unit:e}=(0,n.F7)();return{isCoinUnit:e===s,isContUnit:e===a}}},68665:(e,t,r)=>{r.r(t),r.d(t,{default:()=>R});var i=r(76398),n=r(58138),s=r(96832),a=r(83680),o=r.n(a);const c=["header_widget","header_symbol_search","symbol_info","header_compare","header_chart_type","display_market_status","symbol_search_hot_key","border_around_the_chart","remove_library_container_border","symbol_info","header_interval_dialog_button","show_interval_dialog_on_key_press","volume_force_overlay","header_resolutions","legend_context_menu","left_toolbar","timeframes_toolbar"];var l=r(18101),u=r(71007),m=r(17858),y=r(24366),d=r(65440),p=r(88594),b=(r(42405),r(12560)),v=r(19805),k=r(4303),f=r(88673),g=r(17776),T=r(81841),h=r(31677),_=r(55670),M=r(25336),I=r(35833),D=r(60253),O=r(43567),C=r(24598);const P=({symbol:e,type:t,priceType:r})=>`${e}@${t}@${r}`,S=e=>{const[t,r,i]=e.split("@");return{symbol:t,type:r,priceType:i}},{brandName:F=""}=window.brokerConfig,j=[b.ls.TRADING,b.ls.DELIVERING];var x;!function(e){e.Futures="futures",e.FuturesMark="futures-mark",e.FuturesIndex="futures-index",e.Delivery="delivery",e.DeliveryMark="delivery-mark",e.DeliveryIndex="delivery-index"}(x||(x={}));const V=({ticker:e,name:t,productType:r,pricePrecision:i})=>({name:t,fullName:t,description:t,ticker:e,tickSize:Math.pow(10,i),exchange:F,supportedResolutions:l.k.DefaultResolutions,type:r});var w=r(54813);var $=r(59712);const L=(e,t)=>{[y.sy,y.O7].map((e=>o().createInstance({name:e}))).forEach((r=>r.setItem(t,e)))},R=({symbol:e,namespace:t,useMiniTicker:r=!1})=>{const a=l.k.Store.createStore(t),[b,R]=(0,s.useState)(1),E=a(l.k.Store.getTrueInterval),[U]=a(l.k.Store.getPriceType),A=(0,u.Vh)(),{contractType:q}=A[e]||{},{datafeed:B,symbolsInfo:G}=(({namespace:e,useMiniTicker:t=!1})=>{const r=l.k.Store.createStore(e),{getI18n:n}=(0,v.ZK)("trd-chart","trade-ui"),{getI18n:a}=(0,v.yk)(),o=(0,u.Vh)(),c=(0,s.useRef)(o),{isContUnit:m}=(0,C.Q)(),y=(0,u._n)(),[d]=r(l.k.Store.getPriceType),p=(0,s.useRef)(y),b=(0,s.useRef)(d);c.current=o,p.current=y,b.current=d;const k=(0,s.useMemo)((()=>m?O.D:O.V),[m]),f=(0,s.useMemo)((()=>a("usdtFutures-13",{defaultValue:"Futures"})||""),[a]),g=(0,s.useMemo)((()=>a("inverseFutures-13",{defaultValue:"Delivery"})||""),[a]),T=(0,s.useMemo)((()=>n("indexPrice",{defaultValue:"Index Price"})||""),[n]),w=(0,s.useMemo)((()=>n("markPrice",{defaultValue:"Mark Price"})||""),[n]),$=(0,s.useMemo)((()=>n("lastPrice",{defaultValue:"Last Price"})||""),[n]),L=(0,s.useMemo)((()=>({exchanges:[{name:F,value:F,desc:""}],symbols_types:[{name:f,value:x.Futures},{name:`${f} ${w}`,value:x.FuturesMark},{name:`${f} ${T}`,value:x.FuturesIndex}]})),[g,f,T,w]),R=(0,s.useCallback)((()=>(0,i.mG)(void 0,void 0,void 0,(function*(){try{yield(({checker:e,interval:t=1e3,timeout:r=1e4})=>{let i;return Promise.race([new Promise((r=>{i=setInterval((()=>e()&&r()),t)})),new Promise(((e,t)=>{setTimeout((()=>t(new Error("timeout"))),r)}))]).finally((()=>clearInterval(i)))})({checker:()=>Object.keys(c.current).length>0})}catch(e){}const e=c.current;return Object.keys(e).reduce(((t,r)=>{const{symbol:i,pricePrecision:n,isDelivery:s,contractStatus:o,contractType:c}=e[r];if(!j.includes(o))return t;const{symbol:u,contractTypeI18n:m,deliveryDateFormat:y}=(0,h.H)(e[r],a),d=`${u} ${m}${y?` ${y}`:""}`,p=P({symbol:i,type:c,priceType:l.k.Store.PriceType.Last}),b=P({symbol:i,type:c,priceType:l.k.Store.PriceType.Index}),v=P({symbol:i,type:c,priceType:l.k.Store.PriceType.Mark});return t[p]=V({ticker:p,name:`${d} ${$}`,productType:s?x.Delivery:x.Futures,pricePrecision:n}),t[b]=V({ticker:b,name:`${d} ${T}`,productType:s?x.DeliveryIndex:x.FuturesIndex,pricePrecision:n}),t[v]=V({ticker:v,name:`${d} ${w}`,productType:s?x.DeliveryMark:x.FuturesMark,pricePrecision:n}),t}),{})}))),[a,T,w,$]),E=(0,s.useCallback)((({symbolInfo:e,resolution:t,rangeStartDate:r,rangeEndDate:n})=>(0,i.mG)(void 0,void 0,void 0,(function*(){const i=c.current,{symbol:s="",priceType:a=b.current}=S(e.ticker||""),{pair:o,contractType:u,contractVal:m,isDelivery:y}=i[s],d=Math.max(0,1e3*r),p=1e3*n,v=l.k.utils.TVResolutionToTrueInterval[t],f=y?k(m):e=>e,g=(0,D.b)({symbol:s,pair:o,contractType:u,interval:v,isDelivery:y,priceType:a});return(yield(0,I.M)({onFetchKlineData:g,startTime:d,endTime:p})).map(f)}))),[k]),U=(0,s.useCallback)((({symbolInfo:e,resolution:r,callback:i})=>{const n=c.current,{symbol:s="",priceType:a=b.current}=S(e.ticker||""),{pair:o,contractType:u,contractVal:m,isDelivery:y}=n[s],d=l.k.utils.TVResolutionToTrueInterval[r],p=y?k(m):e=>e;return(0,M.Ld)({symbol:s,pair:o,contractType:u,interval:d,priceType:a,isDelivery:y,useMiniTicker:t,checkIfInSync:()=>!0,callback:e=>i(p(e))})}),[k,t]),A=(0,s.useCallback)((()=>(0,i.mG)(void 0,void 0,void 0,(function*(){const{serverTime:e}=yield(0,_.b)(!0);return Math.floor(parseInt(`${e}`,10)/1e3)}))),[]),q=(0,s.useMemo)((()=>l.k.createDatafeed()),[]),{datafeed:B,symbolsInfo:G}=q({config:L,onFetchSymbolsInfo:R,onFetchBars:E,onSubscribeBars:U,onFetchServerTimeApi:A});return{datafeed:B,symbolsInfo:G}})({namespace:t,useMiniTicker:r}),N=(0,u.Fg)(),H="light"===N?p.ib:p.Cs,Q=(0,d.k)(N),K=(0,s.useMemo)((()=>o().createInstance({name:t})),[t]),Y=(e=>{switch(e){case y.g8.IndexPrice:return"ipTradingView";case y.g8.MarkPrice:return"mpTradingView";default:return"myTradingView"}})(U),W=(0,s.useMemo)((()=>`${t}-${y.P7}_${Y}_${H}`),[t,Y,H]),X=(0,s.useMemo)((()=>P({symbol:e,type:q,priceType:U})),[e,q,U]),Z=(0,s.useRef)(-1),{executionOrders:z}=(({symbol:e,namespace:t})=>{const r=l.k.OrderHistoryStore.createStore(t),[i]=r(l.k.OrderHistoryStore.getOrderHistory),{getI18n:n}=(0,v.KL)(),a=(({symbol:e})=>{const{getI18n:t}=(0,k.yk)(),r=(0,g.AM)(),{baseAsset:i,marginAsset:n,isDelivery:s}=r[e]||{},{unit:a}=(0,T.F7)();return s?a===f.coinFuturesUnit.coin?i:t("Cont"):a===f.usdtFuturesUnit.usdt?n:i})({symbol:e}),o=(0,u.AM)(),{baseAsset:c,pricePrecision:m,quantityPrecision:y,equalQtyPrecision:d,isDelivery:p,contractVal:b}=o[e]||{},h=(0,s.useMemo)((()=>n("openOrder-sideBuyBOTH",{defaultValue:"Buy"})||""),[n]),_=(0,s.useMemo)((()=>n("openOrder-sideSellBOTH",{defaultValue:"Sell"})||""),[n]),M=(0,s.useMemo)((()=>a===c?p?d:y:p?y:m),[p,a,c,d,m,y]),I=(0,s.useCallback)((({avgPrice:e,executedQty:t})=>p?(0,w.GW)(a===c?(({price:e,cont:t,contractVal:r})=>t*r/e)({price:e,cont:t,contractVal:b}):t,M):(0,w.mD)(a===c?t:t*e,M)),[c,b,p,M,a]);return{executionOrders:(0,s.useMemo)((()=>i.filter((({status:e,executedQty:t})=>"FILLED"===e.toUpperCase()||"PARTIAL FILL"===e.toUpperCase()||"PARTIALLY_FILLED"===e.toUpperCase()||"EXPIRED"===e.toUpperCase()&&t>0||"CANCELED"===e.toUpperCase()&&t>0)).map((({id:e,avgPrice:t,side:r,time:i,executedQty:n})=>{const s=`${"BUY"===r?h:_} ${I({avgPrice:t,executedQty:n})} @ ${(+t).toFixed(m)}`;return{id:e,text:"",price:+t,quantity:"",time:Math.round(i/1e3),isBuy:"BUY"===r,tooltip:s}}))),[i,h,_,I,m])}})({symbol:e,namespace:t});(0,m.M)(e,r),(0,m.j)({symbol:e,interval:E,priceType:U});const J=(0,s.useCallback)((()=>{Z.current=Date.now()}),[]),ee=(0,s.useCallback)((e=>(0,i.mG)(void 0,void 0,void 0,(function*(){return L(e,Y)}))),[Y]),te=(0,s.useCallback)((()=>{}),[]),re=(0,s.useCallback)((()=>(0,i.mG)(void 0,void 0,void 0,(function*(){const e=yield K.getItem(Y);L(e,Y)}))),[K,Y]),ie=(0,s.useCallback)((e=>$.log("tv-error",e)),[]),ne=(0,s.useCallback)((()=>{}),[]),se=(0,s.useCallback)((()=>{}),[]),ae=(0,s.useMemo)((()=>U===y.g8.LastPrice?c:[...c,"create_volume_indicator_by_default","create_volume_indicator_by_default_once","show_interval_dialog_on_key_press"]),[U]),oe=(0,s.useCallback)((()=>K.removeItem(Y)),[K,Y]);return(0,s.useEffect)((()=>{R((e=>-1*e))}),[U]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.k.Containers.TradingView,{namespace:t,theme:H,storageName:Y,tradingViewProps:{symbol:X,symbolsInfo:G,theme:Q,limitOrders:[],positionOrders:[],executionOrders:z,initialConfig:{tvConfig:{container_id:W,library_path:"charting_library_next/",symbol:X,theme:Q,datafeed:B,disabled_features:ae},onScriptLoaded:J,onSave:ee,onChartReadyDone:te,onWillUnmount:re,onCreateOrderShapesError:ie,onFirstTimeDataLoadedDone:ne,onSetThemeDone:se}},errorBoundaryProps:{name:"trading_view",onReset:oe}},`tv-${b}`)})}},17858:(e,t,r)=>{r.d(t,{j:()=>o,M:()=>c});var i=r(96832),n=r(18101),s=r(12560),a=r(17776);const o=({symbol:e,interval:t,priceType:r})=>{const{pair:o,contractType:c,isDelivery:l}=(0,a.Vh)()[e]||{},u=(0,i.useRef)();(0,i.useEffect)((()=>{if(!o||!c)return()=>null;const i="mark"===r?e:o;return u.current=void 0,n.k.utils.intervalToMillseconds(t),(l?(0,s.RU)():(0,s.BN)()).getContinuousKlineStream(i,c,t,{priceType:r,symbol:e}).subscribe((e=>{u.current&&(e.time,u.current.time),u.current=e}))}),[o,e,t,c,r,l])},c=(e,t)=>{const{isDelivery:r}=(0,a.Vh)()[e]||{},n=(0,i.useRef)();(0,i.useEffect)((()=>t?()=>null:(r?(0,s.RU)():(0,s.BN)()).getStreamTradeSnap(e).subscribe((e=>{const t=e[e.length-1];n.current&&(t.tradeTime,n.current.tradeTime),n.current=t}))),[r,e,t])}},60253:(e,t,r)=>{r.d(t,{b:()=>n});var i=r(97313);const n=({symbol:e,pair:t,contractType:r,interval:n,isDelivery:s,priceType:a})=>o=>s&&"last"===a?(0,i.kV)(Object.assign(Object.assign({},o),{symbol:t,contractType:r,interval:n})):s&&"mark"===a?(0,i.uX)(Object.assign(Object.assign({},o),{symbol:e,interval:n})):s&&"index"===a?(0,i.te)(Object.assign(Object.assign({},o),{pair:t,interval:n})):"mark"===a?(0,i.C1)(Object.assign(Object.assign({},o),{symbol:e,interval:n})):"index"===a?(0,i.hH)(Object.assign(Object.assign({},o),{pair:t,interval:n})):(0,i.MZ)(Object.assign(Object.assign({},o),{symbol:t,contractType:r,interval:n}))},35833:(e,t,r)=>{r.d(t,{M:()=>n});var i=r(76398);const n=({onFetchKlineData:e,startTime:t,endTime:r,limit:n=1e3})=>(0,i.mG)(void 0,void 0,void 0,(function*(){const i=[];let s=[],a=r;const o=0!==r;do{if(s=yield e(Object.assign(Object.assign({},0===a?{}:{endTime:a}),{limit:n})),0===s.length)break;s.forEach((([e,t,r,n,s,a,,o])=>{i.push({time:+e,open:+t,high:+r,low:+n,close:+s,volume:+a,quantity:+o})})),a=s[0][0]-1}while(s.length===n&&a>t&&o);return i.sort(((e,t)=>e.time-t.time)),i}))},43567:(e,t,r)=>{r.d(t,{D:()=>n,V:()=>i});const i=e=>t=>Object.assign(Object.assign({},t),{volume:t.quantity,quantity:t.volume*e}),n=e=>t=>Object.assign(Object.assign({},t),{volume:t.volume,quantity:t.volume*e})},25336:(e,t,r)=>{r.d(t,{Ld:()=>c});var i=r(18101),n=r(12560),s=r(59712);const a=e=>e,o=e=>e,c=({symbol:e,pair:t,contractType:r,interval:c,priceType:l,isDelivery:u,useMiniTicker:m,callback:y,checkIfInSync:d=(()=>!0)})=>{const p=(0,n.BN)(),b="mark"===l?e:t,v=p.getContinuousKlineStream(b,r,c,{priceType:l,symbol:e});v.selector=a;const k=m?p.getStreamTickers():p.getStreamTradeSnap(e);k.selector=m?(e=>t=>t[e])(e):o;const f=function(e=[]){const t=[];function r(){t.forEach((e=>e()))}return r.subscribe=function(r){const i=[];e.forEach(((e,n)=>{const s=e.subscribe((t=>{i[n]=e.selector(t),r(i)}));t.push(s)}))},r}([v,k]);return f.subscribe((([e,t])=>{if(!t||!e||!d())return;const r=Object.assign({},e);if("last"===l){const e=Array.isArray(t)?t.slice(-1).pop():t,n=i.k.utils.intervalToMillseconds(c),a=+(e.price||e.lastPrice),o=+(e.quantity||e.quoteVolume),l=e.tradeTime||e.eventTime;try{if("1M"===c){const e=new Date(l),t=new Date(r.time).getMonth();if(e.getMonth()>t){const e=+new Date(r.time).setMonth(t+1);Object.assign(r,Object.assign({time:e,open:a,high:a,low:a,close:a},m?{volume:0,quantity:0}:{volume:o,quantity:o}))}}else if(l-r.time>n){const e=r.time+Math.floor((l-r.time)/n)*n;Object.assign(r,Object.assign({time:e,open:a,high:a,low:a,close:a},m?{volume:0,quantity:0}:{volume:o,quantity:o}))}}catch(e){s.error(e)}r.close=a}y(r,e)})),f}}}]);