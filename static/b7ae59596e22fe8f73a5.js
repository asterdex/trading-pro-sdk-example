"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[1963],{23971:(e,t,i)=>{i.d(t,{gN:()=>a,QV:()=>s.Q});var s=i(24598),n=i(96832),r=i(12560);function a(){const[e,t]=(0,n.useState)({});return(0,n.useEffect)((()=>(0,r.RU)().getContractInfoStream().subscribe((e=>{t(e)}))),[]),e}i(51745),i(75028),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature},75028:(e,t,i)=>{i.d(t,{s:()=>m});var s,n=i(96832),r=i(24598),a=i(95408),o=i(30271),l=i(19805);e=i.hmd(e),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&s(e);var c,d,u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},m=function(e){var t=(0,l.yk)().getI18n,i=(0,r.Q)().isCoinUnit,s=e||{},c=s.contractVal,d=s.equalQtyPrecision,u=s.precision,m=(0,n.useCallback)((function(e){var t=e.quantity,s=e.price,n=e.func,r=void 0===n?a.mD:n,l=e.format,u=void 0===l||l;return i?(0,o.unitChangeCoinQty)({quantity:t,price:s,contractVal:c,precision:d,func:r,format:u}):t}),[c,d,i]),p=(0,n.useCallback)((function(){return i?e[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"marginAsset"]:t("Cont",{defaultValue:"Cont"})}),[t,i,e]),h=(0,n.useCallback)((function(){return i?d:u}),[d,i,u]);return(0,n.useMemo)((function(){return{getQuantity:m,getAssetLabel:p,getPrecision:h}}),[p,h,m])};u(m,"useFuturesLanguage{{ getI18n: getFuturesI18n }}\nusePreferenceUnit{{ isCoinUnit }}\nuseCallback{getQuantity}\nuseCallback{getAssetLabel}\nuseCallback{getPrecision}\nuseMemo{}",(function(){return[l.yk,r.Q]})),(c="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(c.register((function(e){var t=e.quantity,i=e.price,s=e.contractVal;return Math.floor(t*i/s)}),"unitChangeCoinToCont","/Users/hong/Desktop/Projects/x-mono/apps/cloud-trade-sdk/src/delivery/hooks/useUnitChange.js"),c.register(m,"useUnitChange","/Users/hong/Desktop/Projects/x-mono/apps/cloud-trade-sdk/src/delivery/hooks/useUnitChange.js")),(d="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&d(e)},17019:(e,t,i)=>{var s,n,r;function a(e){return Number.isNaN(e)||Math.abs(e)===1/0}function o(e){var t,i,s=e.quantity,n=e.isBuy,r=e.entryPrice,o=void 0===r?0:r,l=e.closedPrice,c=void 0===l?0:l,d=e.contractVal,u=void 0===d?100:d,m=e.isDelivery,p=e.askPrice,h=e.bidPrice,g=n?1:-1;return m?(t=s?(1/o-1/(n?h:p))*s*u*g:0,i=s?(1/o-1/c)*s*u*g:0):(t=s?((n?h:p)-o)*s*g:0,i=(c-o)*s*g),{marketPNL:a(t)?"-":t,limitPNL:a(i)?"-":i}}i.d(t,{k:()=>o}),e=i.hmd(e),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&s(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature,(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(n.register(a,"isIllegalNumber","/Users/hong/Desktop/Projects/x-mono/apps/cloud-trade-sdk/src/futures/utils/estimatedPNL.js"),n.register(o,"calcEstimatedPNL","/Users/hong/Desktop/Projects/x-mono/apps/cloud-trade-sdk/src/futures/utils/estimatedPNL.js")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)},39478:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(96832),n=i(415);const r=e=>s.createElement(n.Z,{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 16 24",...e},s.createElement("path",{d:"M5.957 11.253a.7.7 0 01-.546-1.137l2.042-2.553a.7.7 0 011.094 0l2.042 2.553a.7.7 0 01-.546 1.137H5.957zm0 1.494a.7.7 0 00-.546 1.137l2.042 2.553a.7.7 0 001.094 0l2.042-2.553a.7.7 0 00-.546-1.137H5.957z"}))},3101:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(96832),n=i(415);const r=e=>s.createElement(n.Z,{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 16 24",...e},s.createElement("path",{fill:"#7E9AFF",d:"M5.957 12.747a.7.7 0 00-.546 1.137l2.042 2.553a.7.7 0 001.094 0l2.042-2.553a.7.7 0 00-.546-1.137H5.957z"}),s.createElement("path",{fill:"currentColor",d:"M5.957 11.253a.7.7 0 01-.546-1.137l2.042-2.553a.7.7 0 011.094 0l2.042 2.553a.7.7 0 01-.546 1.137H5.957z"}))},6130:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(96832),n=i(415);const r=e=>s.createElement(n.Z,{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 16 24",...e},s.createElement("path",{fill:"#7E9AFF",d:"M5.957 11.253a.7.7 0 01-.546-1.137l2.042-2.553a.7.7 0 011.094 0l2.042 2.553a.7.7 0 01-.546 1.137H5.957z"}),s.createElement("path",{fill:"currentColor",d:"M5.957 12.747a.7.7 0 00-.546 1.137l2.042 2.553a.7.7 0 001.094 0l2.042-2.553a.7.7 0 00-.546-1.137H5.957z"}))},30999:(e,t,i)=>{i.d(t,{N:()=>r});var s=i(96832);const n=()=>{const e=(0,s.useRef)(!1);return(0,s.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),(0,s.useCallback)((()=>e.current),[])};function r(e,t,i){const r=(0,s.useRef)(0),a=n(),[o,l]=(0,s.useState)(Date.now()),[c,d]=(0,s.useState)({loading:!0,updateTime:Date.now(),...i});return(0,s.useEffect)((()=>{const t=++r.current;!1===c.loading&&d({...c,loading:!0}),e().then((e=>{const s=null==e?i?.value:e;a()&&t===r.current&&d({value:s,loading:!1,error:null,updateTime:Date.now()})})).catch((e=>{a()&&t===r.current&&d({...i,loading:!1,error:e,updateTime:Date.now()})}))}),[...t,o]),{...c,onRefresh:()=>l(Date.now)}}},4993:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(96832),n=i(415);const r=e=>s.createElement(n.Z,{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...e},s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.288 12l-3.89 3.89 1.768 1.767L15.823 12l-1.768-1.768-3.889-3.889-1.768 1.768 3.89 3.89z",fill:"currentColor"}))},79457:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(96832),n=i(415);const r=e=>s.createElement(n.Z,{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...e},s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 21a9 9 0 100-18 9 9 0 000 18zm-1.25-5.5V18h2.5v-2.5h-2.5zm0-9.5v7h2.5V6h-2.5z",fill:"currentColor"}))},34708:(e,t,i)=>{i.d(t,{Y:()=>s});const s=new class{constructor(){this.cbs={},this.on=(e,t)=>(this.cbs[e]||(this.cbs[e]=[]),this.cbs[e].push(t),()=>this.off(e,t)),this.off=(e,t)=>{this.cbs[e]||(this.cbs[e]=[]),this.cbs[e]=this.cbs[e].filter((e=>e!==t))},this.emit=(e,...t)=>{this.cbs[e]||(this.cbs[e]=[]),this.cbs[e].forEach((e=>"function"==typeof e&&e.apply(null,t)))}}}},51745:(e,t,i)=>{i.d(t,{C:()=>m});var s=i(74958),n=i(17776),r=i(24047),a=i(19737),o=i(69417),l=i(96081),c=i(6247),d=i(30271),u=i(28071);const m=({symbol:e,positionSide:t,orderPrice:i,assumePrice:m,triggerPrice:p,activationPrice:h,orderAmount:g,formType:y,side:b,cost:x,openLost:f,contractVal:j,reduceOnly:v=!1})=>{const P=(0,s.v9)(r.Y),k=(0,a.$J)(),O=(0,s.v9)(o._Y),C=(0,s.v9)(l.G),S=(0,n.AM)(),{marginAsset:M="BTC"}=(null==S?void 0:S[e])||{},T=(null==O?void 0:O[M])||{},w=(0,c._g)(e,t),K=k[w]||{},{entryPrice:N,positionSize:z,isolatedWallet:Z,bidNotional:A,askNotional:I}=K,V=Math.abs(z),R=Number(z),{takerCommission:L}=(0,n.aq)();if((1===b&&R<0||-1===b&&R>0)&&V&&(V===g||V<g&&v))return{liquidationPrice:0,currentPosition:K};const{estIsolatedWallet:q,estCrossWalletBalance:E}=(0,d.calculateEstWalletBalance)({entryPrice:N,positionSize:z,orderPrice:i,assumePrice:m,triggerPrice:p,activationPrice:h,orderAmount:g,formType:y,side:b,isolatedWallet:Z,crossWalletBalance:(null==T?void 0:T.crossWalletBalance)||0,cost:x,openLost:f,bidNotional:A,askNotional:I,contractVal:j,takerCommission:(L||0)/1e6}),D=Object.assign(Object.assign({},K),{entryPrice:(0,d.calculateEstEP)({entryPrice:N,positionSize:z,orderPrice:i,assumePrice:m,triggerPrice:p,activationPrice:h,orderAmount:g,formType:y,side:b}),positionSize:(0,d.calculateEstSize)({positionSize:z,orderAmount:g,side:b}),isolatedWallet:q}),U=Object.values(Object.assign(Object.assign({},k),{[w]:Object.assign({},D)})),$=(0,c.nn)({positions:(0,c.J9)(U),marginAsset:M}),F=(0,u.Ak)(P,[D],Object.assign(Object.assign({},O),{[M]:Object.assign(Object.assign({},O[M]),{crossWalletBalance:E})}),C,e,!0,!1,$),{liquidationPrice:B=0}=(null==F?void 0:F[0])||{};return{liquidationPrice:B,currentPosition:D}}},3263:(e,t,i)=>{i.d(t,{ME:()=>n,ZP:()=>a,hZ:()=>r});var s=i(97556);const n=e=>e.posCalcData,r=e=>e.setPosCalcData,a=s.Gt},81365:(e,t,i)=>{i.d(t,{z1:()=>R,A4:()=>V,Mx:()=>Q,Yq:()=>G,jK:()=>W,qU:()=>Y,ek:()=>_,v_:()=>H,iA:()=>I,Mn:()=>L});var s=i(12560),n=i(96832),r=i(74958),a=i(31677),o=i(71882),l=i(19805),c=i(71007),d=i(58851),u=i(59712);const{calculation:{abacus:{future:{model:m,calculateUmLiquidationPriceForSingleAssetMode:p},model:h,base:g}}}=d.com,{KotlinArrayList:y}=g,b=m.FutureBalance,x=m.FutureBracket,f=m.RiskBracket,j=h.FuturePosition;var v=i(59771),P=i(47652);const k=(0,v._)((e=>Object.values(e).map((e=>{const{asset:t,marginAvailable:i,initialMargin:s,maintenanceMargin:n,marginBalance:r,unrealizedProfit:a,walletBalance:o,crossWalletBalance:l}=e;return new b(t,Boolean(i),String(s),String(n),String(r),String(a),String(o),String(l))}))));var O=i(17776);const C=(0,v._)((e=>{const t=[];return Object.entries(e).forEach((([e,i])=>{if("boolean"==typeof i)return;const s=i.map((e=>new f(e.bracketMaintenanceMarginRate,e.bracketNotionalCap,e.bracketNotionalFloor,e.bracketSeq,e.cumFastMaintenanceAmount,e.maxOpenPosLeverage,e.minOpenPosLeverage))),n=new x(e,s);t.push(n)})),t}));var S=i(6247);function M(e,t){const{askNotional:i,bidNotional:s,collateral:n=(null==t?void 0:t.marginAsset)||"",cumRealized:r,entryPrice:a,id:o,leverage:l,notionalValue:c,positionSize:d,symbol:u,markPrice:m,unrealizedProfit:p,isolated:h,isolatedWallet:g,adl:y,positionSide:b}=e;return new j(String(i),String(s),n,String(r),String(a),o,l,String(c),String(d),u,String(m),String(p),h,String(g),y,b)}const T=(0,v._)(((e,t)=>(0,S.J9)(e).map((e=>M(e,t[e.symbol])))));var w=i(3263),K=i(89865),N=i(63884),z=i(43326);const{leverageInfo:Z}=s.SETTING,A={long:"buy",short:"sell"},I=({sideKey:e})=>{const t=(0,c.t2)(e,"symbol"),i=(0,c.t2)(e,"isolated"),s=(0,c.t2)(e,"isolatedWallet"),n=(0,c.t2)(e,"positionSize"),r=0===Number(n)&&i&&Number(s)<0,o=Number(n)>0?"long":"short",d=r?"liq":A[o],{leverageList:u={}}=(0,c.rf)()||{},m=u[t]||Z.defaultVal,p=(0,c.AM)()[t],{getI18n:h}=(0,l.yk)();let g,y=t;return p&&(g=(0,a.H)(p,h),y=g.fullName),{color:d,symbolText:y,symbolName:g,leverage:m}},V=({sideKey:e})=>{const t=(0,c.t2)(e,"symbol"),i=(0,c.t2)(e,"entryPrice"),s=(0,c.AM)()[t]||{},{pricePrecision:n}=s;return{formatedEntryPrice:(0,o.uf)(i,n)}},R=({sideKey:e})=>{const t=(0,c.t2)(e,"symbol"),i=(0,c.t2)(e,"markPrice"),{lastPrice:s}=(0,c.zZ)({symbol:t}),n=(0,c.AM)()[t]||{},{pricePrecision:r}=n;return{formatedMarkPrice:(0,o.uf)(i,r),formatedLastPrice:(0,o.uf)(s,r)}},L=({sideKey:e})=>{var t,i;const s=(0,c.t2)(e,"symbol"),n=(0,c.t2)(e,"positionSize"),r=(0,c.t2)(e,"positionSide"),a=(0,c.AM)()[s]||{},{pricePrecision:l}=a,{preOrders:d}=(0,c.E)(),u=Number(n),m={};d.forEach((e=>{const t=!0===e.closePosition,i=s===e.symbol,n=r===e.positionSide,a=u<0&&"BUY"===e.side||u>0&&"SELL"===e.side;t&&i&&n&&a&&("TAKE_PROFIT_MARKET"===e.type&&(m.tp=e),"STOP_MARKET"===e.type&&(m.sl=e))}));const p=(null===(t=null==m?void 0:m.tp)||void 0===t?void 0:t.stopPrice)?(0,o.uf)(m.tp.stopPrice,l):"--",h=(null===(i=null==m?void 0:m.sl)||void 0===i?void 0:i.stopPrice)?(0,o.uf)(m.sl.stopPrice,l):"--";return{strategyOrders:m,formatedTPPrice:p,formatedSLPrice:h}};var q=i(24598),E=i(30271),D=i(28071);const{leverageInfo:U}=s.SETTING,$={long:"buy",short:"sell"},F=()=>{const e=(0,c.F)(),t=(0,c.AM)()||{};return e.map((e=>{var i;return Object.assign(Object.assign({},e),{contractVal:null===(i=t[e.symbol])||void 0===i?void 0:i.contractVal})}))},B=(0,s.nM)(),H=e=>B?(({sideKey:e,columnKey:t=""})=>{const{getI18n:i}=(0,l.yk)(),s=(0,c.t2)(e,"symbol"),r=(0,c.t2)(e,"isolated"),a=(0,c.t2)(e,"isolatedWallet"),d=(0,c.t2)(e,"positionSize"),u=(0,c.cO)(e)||{},{lastPrice:m}=(0,c.zZ)({symbol:null==u?void 0:u.symbol}),p=(0,w.ZP)(w.hZ),h=Number(d),g=h>0?"long":"short",y=0===h&&r&&Number(a)<0?"liq":$[g],b=(0,c.AM)()[s]||{},{quantityPrecision:x,marginAsset:f="",equalQtyPrecision:j,contractVal:v=100}=b,{isCoinUnit:P}=(0,q.Q)(),k=h>0?"":"-",O=P?(0,E.unitChangeCoinQty)({quantity:Math.abs(h),contractVal:v,price:m,precision:j,format:!1}):h.toFixed(x),C=P?`${k}${O}`:(0,o.uf)(h,x),S=P?f:i("Cont",{defaultValue:"Cont"});return(0,n.useEffect)((()=>{t&&p(e,t,Math.abs(P?Number(O):h))}),[]),{color:y,quantityAmount:O,formatedQuantityAmount:C,unit:S}})(e):(({sideKey:e,columnKey:t=""})=>{const i=(0,c.t2)(e,"symbol"),s=(0,c.t2)(e,"isolated"),r=(0,c.t2)(e,"isolatedWallet"),a=(0,c.t2)(e,"positionSize"),l=(0,c.cO)(e)||{},{lastPrice:d}=(0,c.zZ)({symbol:null==l?void 0:l.symbol}),u=(0,w.ZP)(w.hZ),m=Number(a),p=m>0?"long":"short",h=0===m&&s&&Number(r)<0?"liq":A[p],g=(0,c.AM)()[i]||{},{baseAsset:y="",pricePrecision:b=2,quantityPrecision:x=8,marginAsset:f=""}=g,{isCoinUnit:j}=(0,K.Q)(),v=m>0?"":"-",P=j?m.toFixed(x):(0,N.WA)({quantity:Math.abs(m),price:d,precision:b,format:!1}),k=j?(0,o.uf)(m,x):`${v}${P}`,O=j?y:f;return(0,n.useEffect)((()=>{t&&u(e,t,Math.abs(j?m:Number(P)))}),[]),{color:h,quantityAmount:P,formatedQuantityAmount:k,unit:O}})(e),W=e=>B?(({sideKey:e,columnKey:t=""})=>{const i=(0,c.t2)(e,"symbol"),s=(0,c.t2)(e,"positionSize"),r=(0,w.ZP)(w.hZ),a=(0,c.AM)()[i]||{},{contractVal:l}=a,d=Math.abs(s)*Number(l),u=l?(0,o.uf)(d,2):"-";return(0,n.useEffect)((()=>{t&&r(e,t,d)}),[]),{notionalSize:d,formattedNotionalSize:u,unit:"USD"}})(e):(({sideKey:e,columnKey:t=""})=>{const i=(0,c.t2)(e,"symbol"),s=(0,c.t2)(e,"positionSize"),r=(0,c.t2)(e,"markPrice"),a=(0,w.ZP)(w.hZ),l=(0,c.AM)()[i]||{},{quoteAsset:d=""}=l,u=Math.abs(s)*r,m=(0,o.uf)(u,2);return(0,n.useEffect)((()=>{t&&a(e,t,u)}),[]),{notionalSize:u,formattedNotionalSize:m,unit:d}})(e),Q=e=>B?(({sideKey:e,columnKey:t=""})=>{const i=(0,c.KQ)(),s=(0,c.Gf)(),r=F(),a=(0,c.cO)(e)||{},l=(0,w.ZP)(w.hZ),{symbol:d,isolated:u,isolatedWallet:m=0,positionSide:p}=a,h=(0,c.AM)()[d]||{},{marginAsset:g,pricePrecision:y,contractVal:b}=h,x=Object.assign(Object.assign({},a),{contractVal:b}),f=i[g]||{},{crossWalletBalance:j=0}=f,v=(null==s?void 0:s[d])||[],P=!u&&p&&"BOTH"!==p,k=u?m:j;let O=0;if(!u){const e=r.filter((e=>e.marginAsset===g)).filter((e=>!(null==e?void 0:e.isolated))).filter((e=>(null==e?void 0:e.symbol)!==d));O=(0,D.zW)(e,s)-(0,D.ot)(e)}let C,S,M=0;if(P){const e=r.filter((e=>{const{symbol:t,positionSide:i}=e||{};return t===d&&"BOTH"!==i&&i!==p}))[0]||{positionSize:0,entryPrice:0};C="LONG"===p?x:e,S="SHORT"===p?x:e}M=P&&C.positionSize&&S.positionSize?(0,D.ST)(v,k,O,C,S,x):(0,D.W8)(v,k,O,x),M=M<0?0:M;const T=M>0?(0,o.uf)(M,y):"-";return(0,n.useEffect)((()=>{t&&l(e,t,M)}),[]),{liquidationPrice:M,formatedLiqPrice:T}})(e):(({sideKey:e,columnKey:t=""})=>{const i=function(){const e=(0,P.KQ)();return k(e)}(),s=function(){const e=(0,O.Gf)();return C(e)}(),a=(()=>{const e=(0,r.v9)((e=>e.position.positionMap)),t=(0,O.Vh)();return T(e,t)})(),l=(e=>{const t=(0,r.v9)((e=>e.position.positionMap))[e],i=(0,O.Vh)();return t?M(t,i[t.symbol]):null})(e),d=(0,c.t2)(e,"symbol"),m=(0,w.ZP)(w.hZ),h=(0,c.AM)()[d]||{},{pricePrecision:g}=h;let y=0;const b=(0,r.v9)((e=>e.loading.effects.preference.getMultiAssetMarginEnableConfig)),x=(0,r.v9)((e=>e.loading.effects.preference.getAssetMode));b||x||!l||(y=((...e)=>{let t=0;try{t=p(...e)}catch(e){u.log(e)}return t})(l,a,i,s));const f=y>0?(0,o.uf)(y,g):"-";return(0,n.useEffect)((()=>{t&&m(e,t,y)}),[]),{liquidationPrice:y,formatedLiqPrice:f}})(e),_=e=>B?(({sideKey:e,columnKey:t=""})=>{const i=(0,c.KQ)(),s=(0,c.Gf)(),r=F(),a=(0,c.cO)(e)||{},{symbol:o,isolated:l}=a,d=(0,c.AM)()[o]||{},u=(0,w.ZP)(w.hZ),{marginAsset:m,contractVal:p}=d;let h;if(l){const{isolatedWallet:e=0,symbol:t}=a,i=(null==s?void 0:s[t])||[],n=(0,D.SH)(i,Object.assign(Object.assign({},a),{contractVal:p})),r=(0,D.nn)(Object.assign(Object.assign({},a),{contractVal:p}));h=(0,D.Vo)(n,e,r)}else{const e=i[m]||{},{crossWalletBalance:t=0}=e,n=r.filter((e=>e.marginAsset===m)).filter((e=>!(null==e?void 0:e.isolated))),a=(0,D.zW)(n,s),o=(0,D.ot)(n);h=(0,D.Vo)(a,t,o)}const g=Number(h)>80?"negative":"";return(0,n.useEffect)((()=>{t&&u(e,t,Number(h))}),[]),{ratioColor:g,riskRatio:h}})(e):(({sideKey:e,columnKey:t=""})=>{const i=(0,c.KQ)(),s=(0,c.Gf)(),a=(0,c.F)(),o=(0,c.cO)(e)||{},{symbol:l,isolated:d}=o,u=(0,c.AM)()[l]||{},m=(0,w.ZP)(w.hZ),{marginAsset:p}=u;let h;if(d){const{isolatedWallet:e=0,symbol:t}=o,i=(null==s?void 0:s[t])||[],n=(0,z.SH)(i,o),r=(0,z.nn)(o);h=(0,z.Vo)(n,e,r)}else{const e=i[p]||{},{crossWalletBalance:t=0}=e,n=a.filter((e=>e.marginAsset===p)).filter((e=>!(null==e?void 0:e.isolated))),r=(0,z.zW)(n,s),o=(0,z.ot)(n);h=(0,z.Vo)(r,t,o)}const g=(0,r.v9)((e=>e.loading.effects.preference.getMultiAssetMarginEnableConfig)),y=(0,r.v9)((e=>e.loading.effects.preference.getAssetMode));(g||y)&&(h="0.00");const b=Number(h)>80?"negative":"";return(0,n.useEffect)((()=>{t&&m(e,t,Number(h))}),[]),{ratioColor:b,riskRatio:h}})(e),G=e=>B?(({sideKey:e,columnKey:t=""})=>{const i=(0,c.ce)(),s=(0,c.cO)(e)||{},r=(0,w.ZP)(w.hZ),{symbol:a,isolated:l,isolatedWallet:d=0,positionSize:u,markPrice:m}=s,{leverageList:p={}}=(0,c.rf)()||{},h=p[a]||U.defaultVal,g=(0,c.AM)()[a]||{},{marginAsset:y="",contractVal:b=100}=g,x=(0,D.fS)({positionSize:u,markPrice:m,contractVal:b})*(0,D.yh)(h),f=l?d:x,j=`${(0,o.GW)(f,i,!0)} ${y}`;return(0,n.useEffect)((()=>{t&&r(e,t,f)}),[]),{margin:f,formatedMargin:j}})(e):(({sideKey:e,columnKey:t=""})=>{const i=(0,c.ce)(),s=(0,c.cO)(e)||{},r=(0,w.ZP)(w.hZ),{symbol:a,isolated:l,isolatedWallet:d=0}=s,{leverageList:u={}}=(0,c.rf)()||{},m=u[a]||Z.defaultVal,p=(0,c.AM)()[a]||{},{marginAsset:h=""}=p,g=(0,z.fS)(s)*(0,z.yh)(m),y=l?d:g,b=`${(0,o.uf)(y,i)} ${h}`;return(0,n.useEffect)((()=>{t&&r(e,t,y)}),[]),{margin:y,formatedMargin:b}})(e),Y=e=>B?(({sideKey:e,columnKey:t=""})=>{const{useLastPrice:i}=(0,c.F7)(),s=(0,c.ce)(),r=(0,c.cO)(e)||{},a=(0,w.ZP)(w.hZ),{symbol:l,positionSize:d,markPrice:u}=r,{leverageList:m={}}=(0,c.rf)()||{},p=m[l]||U.defaultVal,{lastPrice:h}=(0,c.zZ)({symbol:l}),g=(0,c.AM)()[l]||{},{marginAsset:y="",contractVal:b=100}=g,x=(0,D.fS)({positionSize:d,markPrice:u,contractVal:b})*(0,D.yh)(p),f=(0,D.nn)(Object.assign(Object.assign({},r),{contractVal:b,lastPrice:h}),i),j=0===Number(f)?"":Number(f)>0?"buy":"sell",v=0===Number(f)?"":Number(f)>0?"+":"",P=`${v}${(0,o.GW)(f,s,!0)} ${y} `,k=100*(f/x||0),O=`${v}${k.toFixed(2)}%`;return(0,n.useEffect)((()=>{t&&a(e,t,k)}),[]),{unrealizedPnl:f,formatedPnl:P,pnlColor:j,ROEVal:O}})(e):(({sideKey:e,columnKey:t=""})=>{const{useLastPrice:i}=(0,c.F7)(),s=(0,c.ce)(),r=(0,c.cO)(e)||{},a=(0,w.ZP)(w.hZ),{leverageList:l={}}=(0,c.rf)()||{},d=l[null==r?void 0:r.symbol]||Z.defaultVal,{lastPrice:u}=(0,c.zZ)({symbol:null==r?void 0:r.symbol}),m=(0,c.AM)()[null==r?void 0:r.symbol]||{},{marginAsset:p=""}=m,h=(0,z.fS)(r)*(0,z.yh)(d),g=(0,z.nn)(Object.assign(Object.assign({},r),{lastPrice:u}),i),y=0===Number(g)?"":Number(g)>0?"buy":"sell",b=Number(g)>0?"+":"",x=`${b}${(0,o.GW)(g,s,!0)} ${p}`,f=100*(g/h||0),j=`${b}${f.toFixed(2)}%`;return(0,n.useEffect)((()=>{t&&a(e,t,f)}),[]),{unrealizedPnl:g,formatedPnl:x,pnlColor:y,ROEVal:j}})(e)},11963:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ss});var s=i(58138),n=i(83461),r=i(72249),a=i(31781),o=i(33113),l=i(27008),c=i(70894);const d=(e=!1)=>{let t;t=e?e=>Object.keys(e).length>1?(0,c.r7)({...e}):(0,c.y)({...e}):e=>Object.keys(e).length>1?(0,c.Ce)({...e}):(0,c.O9)({...e});const[{loading:i},s]=(0,l.Z)((async(e={})=>t(e)),[e]);return{loading:i,delOpenOrders:s}};var u=i(73352),m=i.n(u),p=i(96832),h=i(74958),g=i(58107),y=i(19805),b=i(12560),x=i(71007),f=i(76398),j=i(88927),v=i(49247),P=i(10600),k=i(1515),O=i(51485);const C="trd-Position",S=e=>(0,y.ZK)(C,e),M=e=>`${C}-${e}`;var T=i(86282),w=i(16537),K=i(69612),N=i(18637),z=i(79129),Z=i(95408);const A=({type:e,setType:t,maxAppend:i,maxRemovable:n,amount:r,setAmount:a,onConfirm:o,marginAsset:l})=>{const{getI18n:c}=S(),{getI18n:d}=(0,y.yk)(),u=(0,x.ce)(),m=(0,Z.nH)(u),h="ADD"===e?d("maxAddable",{defaultValue:"Max addable"}):d("maxRemovable",{defaultValue:"Max removable"}),g="ADD"===e?i:n,b=`${c("amount",{defaultValue:"Amount"})}(${l})`,f=(0,s.jsxs)(T.Z,Object.assign({as:"span"},{children:[h,(0,s.jsxs)(v.Z,Object.assign({as:"span",color:"t.primary"},{children:[" ",(0,Z.GW)(g,u,!0)," ",l]}))]})),j=(0,Z.GW)(g,u,!1),k=Number(r)>Number(j),O=(0,p.useMemo)((()=>[{value:"ADD",text:d("add",{defaultValue:"Add"})},{value:"REMOVE",text:d("remove",{defaultValue:"Remove"})}]),[d]),C=(0,s.jsxs)(T.Z,Object.assign({sx:{position:"relative"}},{children:[(0,s.jsx)(T.Z,{bg:"line",width:"1px",height:"24px",sx:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)"}}),(0,s.jsx)(T.Z,Object.assign({width:"120px"},{children:(0,s.jsx)(w.Z,Object.assign({hideSearch:!0,variant:"clear",size:"lg",value:e,renderValue:e=>{const t=O.find((t=>t.value===e));if(t)return(0,s.jsx)(v.Z,Object.assign({as:"span"},{children:t.text}))},onChange:e=>t(e)},{children:O.map(((e,t)=>(0,s.jsx)(K.W,Object.assign({value:e.value},{children:e.text}),t)))}))}))]})),M=(0,s.jsx)(P.Z,Object.assign({variant:"quiet",onClick:()=>a(j)},{children:c("Max",{defaultValue:"Max"})}));return(0,s.jsx)(N.Z,{variant:"filled",type:"number",label:b,extraInfo:f,prefix:C,suffix:M,step:m,value:r,error:k,onChange:e=>(0,z._p)(e,a,"",u),onKeyDown:e=>(0,z.f5)(e,o),onBlur:e=>(0,z.Y5)(e)})};var I=i(72729),V=i(79457),R=i(71882),L=i(29543),q=i(23607),E=i(66939);const D=({label:e="",labelSuffix:t="",value:i="",unit:n="",labelClassName:r="",valueClassName:a="",className:o=""})=>(0,s.jsxs)("div",Object.assign({className:`field ${o}`},{children:[(0,s.jsxs)("div",Object.assign({className:`label ${r}`},{children:[e,t]})),(0,s.jsxs)("div",Object.assign({className:`value ${a}`},{children:[i," ",n]}))]})),U=({children:e})=>(0,s.jsx)(T.Z,Object.assign({sx:{width:"282px",fontSize:"12px",lineHeight:"16px"}},{children:e})),$=p.memo((({panelType:e,data:t})=>{const{getI18n:i,t:n}=(0,y.yk)(),{symbol:r,isolatedWallet:a,maxAppend:o,maxRemovable:l,liquidationPrice:c,quoteAsset:d,marginAsset:u="USDT",pricePrecision:m}=t,p=(0,x.ce)(),h=(0,s.jsx)(I.Z,{sx:{color:"t.yellow"},href:"https://docs.asterdex.com/astherusex-orderbook-perp-guide/margin-management",target:"_blank"});return"ADD"===e?(()=>{const e=`${i("currentlyMarginFor",{defaultValue:"Currently Margin for"})} ${(0,E.lE)(r,i)}`,t=(0,R.uf)(a,p),l=i("maxAddable",{defaultValue:"Max addable"}),g=`${(0,Z.GW)(o,p,!0)}`,y=(0,s.jsx)(q.m,Object.assign({tip:(0,s.jsx)(U,{children:(0,s.jsx)(L.c,{t:n,i18nKey:"futures-trade-maxAddableTip",components:{jump:h},defaults:"Isolated position max addable amount is different from the available for order amount. More details are available on the <jump>Isolated transferrable margin calculations</jump>."})}),hideUnderLine:!0,sx:{verticalAlign:"middle"},delay:1e3,placement:"top",arrow:!0},{children:(0,s.jsx)(V.Z,{ml:"4px",size:16})})),b=i("liqPriceAfterAdujst",{defaultValue:"Liq. Price after increase"}),x=c?(0,Z.GW)(c,m,!0):"-";return(0,s.jsxs)(T.Z,Object.assign({mt:"md"},{children:[(0,s.jsx)(D,{label:e,value:t,unit:u}),(0,s.jsx)(D,{label:l,labelSuffix:y,value:g,unit:u}),(0,s.jsx)(D,{label:b,value:x,unit:d})]}))})():(()=>{const e=i("assignedMargin",{defaultValue:"Currently Assigned Margin"}),t=(0,R.uf)(a,p),r=i("maxRemovable",{defaultValue:"Max removable"}),o=(0,Z.GW)(l,p,!0),g=(0,s.jsx)(q.m,Object.assign({tip:(0,s.jsx)(U,{children:(0,s.jsx)(L.c,{t:n,i18nKey:"futures-trade-maxRemovableTip",components:{jump:h},defaults:"Unrealized profit cannot be transferred from the isolated position. More details are available on <jump>Isolated transferrable margin calculations</jump>."})}),hideUnderLine:!0,sx:{verticalAlign:"middle"},delay:1e3,placement:"top",arrow:!0},{children:(0,s.jsx)(V.Z,{ml:"4px",size:16})})),y=i("liqPriceAfterReduction",{defaultValue:"Liquidation Price after reduction"}),b=c?(0,Z.GW)(c,m,!0):"-";return(0,s.jsxs)(T.Z,Object.assign({mt:"md"},{children:[(0,s.jsx)(D,{label:e,value:t,unit:u}),(0,s.jsx)(D,{label:r,labelSuffix:g,value:o,unit:u}),(0,s.jsx)(D,{label:y,value:b,unit:d})]}))})()})),F={position:"relative",padding:"0px 24px 24px 24px",width:["calc(100vw - 32px)","384px"],bg:"modalBg",boxShadow:"elevation3",borderRadius:"8px",".title":{fontSize:"20px",height:"64px",py:"20px",color:"t.primary"},".field":{display:"flex",justifyContent:"space-between",mt:"12px",letterSpacing:"0.16px",fontSize:"14px",lineHeight:"20px",fontWeight:"normal",minHeight:"20px",".label":{color:"t.third",flex:"auto"},".value":{color:"t.primary",textAlign:"right",flex:"none"}}},B={ADD:1,REMOVE:2},H=p.memo((({visible:e,position:t,onClose:i})=>{var n;const{enqueueNotification:r}=(0,a.Z)(),{sideKey:o}=t,{getI18n:l}=S(),{getI18n:c}=(0,y.yk)(),[d,u]=(0,p.useState)("ADD"),[m,h]=(0,p.useState)(""),g="ADD"===d?Number(m):-Number(m),b=(0,x.t2)(o,"symbol"),C=(0,x.t2)(o,"positionSide"),M=(null===(n=(0,x.AM)())||void 0===n?void 0:n[b])||{},{marginAsset:T="",contractVal:w=100}=M,K=(0,p.useMemo)((()=>({symbol:b,marginAsset:T,positionSide:C})),[!1,b,T,w,C]);(0,p.useEffect)((()=>{o||h("")}),[o]);const N=(0,x.Bx)(Object.assign(Object.assign({},K),{delta:g})),z=()=>(0,f.mG)(void 0,void 0,void 0,(function*(){m&&(async(e,t)=>{let i;try{i=await(0,O.v_)("/bapi/futures/v1/private/future/user-data/adjust-position-margin",e,{})}catch(e){i={success:!1}}return i})({type:B[d],symbol:b,amount:m,positionSide:C}).then((e=>{const{success:t}=e;t&&r({message:c("changeMarginSuccess",{defaultValue:"Position margin adjustment failed"}),variant:"success"})})).catch((()=>{})).finally((()=>i()))}));return(0,s.jsxs)(j.Z,Object.assign({visible:!!o&&e,sx:F,onMaskClick:()=>i()},{children:[(0,s.jsx)(v.Z,Object.assign({variant:"title6",className:"title"},{children:l("adjust-margin",{defaultValue:"Adjust Margin"})})),(0,s.jsx)(k.Z,{color:"t.third",sx:{position:"absolute",top:"20px",right:"24px",cursor:"pointer"},onClick:i}),(0,s.jsx)(A,{type:d,setType:u,maxAppend:N.maxAppend,maxRemovable:N.maxRemovable,amount:m,setAmount:h,onConfirm:z,marginAsset:T}),(0,s.jsx)($,{panelType:d,data:N}),(0,s.jsx)(P.Z,Object.assign({sz:"l",mt:"24px",width:1,onClick:z},{children:c("confirmBtn",{defaultValue:"Confirm"})}))]}))})),W=(0,p.createContext)({actionAdjustMarginModal:e=>{},actionOrderConfirmModal:(e,t,i)=>{},actionTpslModal:e=>{},actionPlaceOrder:e=>{},actionCancelOrder:e=>{},changeSymbol:e=>{},isDelivery:!1,headers:[]});var Q=i(30999);async function _(e){let t;try{t=await(0,O.U2)("/fapi/v1/ticker/bookTicker"+(e?`?symbol=${e}`:""))}catch(i){t=e?{}:[]}return t}async function G(e){let t;try{t=await(0,O.U2)("/dapi/v1/ticker/bookTicker"+(e?`?symbol=${e}`:"")),t=e?t?.[0]||{}:t}catch(i){t=e?{}:[]}return t}var Y=i(17019);var J=i(81365),X=i(85022),ee=i(42717),te=i(34095),ie=i(81841);const se=({getFutI18n:e})=>{var t;const[i]=(0,x.z4)(),n=null===(t=(0,x.m8)()[i])||void 0===t?void 0:t.indexPrice,{formatTk:r}=(0,x.mC)();return(0,s.jsx)(s.Fragment,{children:e("markPriceTip",{defaultValue:"Latest mark price for this contract. To prevent price manipulation, the mark price is used for unrealized PNL and margin calculations, and may differ from the last price. \n Mark Price is calculated based on the index price. The Price Index is a bucket of prices from the major Spot market exchanges, weighted by their relative volume. The latest index price is {{indexPrice}}.",indexPrice:r(n)}).replaceAll("\\n","\n")})};var ne=i(86193),re=i(3263);const ae=(e,t)=>e.localeCompare(t),oe=(0,ne.RRI)(ae),le=(e,t)=>+e-+t,ce=(0,ne.RRI)(le),de=["size","notionalSize","liquidationPrice","marginRatio","margin","pnl"],ue=(e,t)=>null==t?void 0:t[e];var me=i(77950);const pe=p.memo((({visible:e,position:t,onClose:i})=>{const{sideKey:n,closeParams:r={},onConfirm:a}=t,{getI18n:o}=(0,y.yk)(),{orderConfirmation:l}=(0,x.F7)(),c=(0,h.I0)(),d=(0,x.t2)(n,"symbol"),u=(0,x.t2)(n,"positionSize"),m=(0,x.t2)(n,"entryPrice"),{orderType:g,limitPrice:b,qty:f,quantity:j}=r,v=(0,x.AM)()[d]||{},{isDelivery:P}=(0,p.useContext)(W),k=u>0?"SELL":"BUY",O="BUY"===k?"buy":"sell",C=o(u>0?"CloseLong":"CloseShort"),S="MARKET"===g,{contractVal:M}=v,[T,w]=(0,p.useState)(0);(0,p.useEffect)((()=>{e&&(P?G:_)(d).then(((e={})=>{const{marketPNL:t,limitPNL:i}=(0,Y.k)(Object.assign(Object.assign({},e),{quantity:j,isBuy:u>0,entryPrice:m,closedPrice:b,contractVal:M,isDelivery:P}));w(S?t:i)}))}),[M,m,P,S,b,u,j,d,e]);const K=(0,p.useCallback)((()=>{const e=Object.assign(Object.assign({},l),{[g.toUpperCase()]:!1});c.preference.changeOrderConfirmation(e)}),[c.preference,l,g]);return(0,s.jsx)(me.Z,{symbol:d,title:C,color:O,isMarket:S,limitPrice:b,qty:f,isClose:!0,epnl:T,onClose:i,onConfirm:a,closeTip:K,orderSide:k})}));var he=i(62600),ge=i(45313),ye=i(82373);const be=p.memo((()=>{const{getI18n:e}=(0,y.yk)(),[t]=(0,x.z4)(),i=(0,h.I0)(),n=(0,x.Xb)(),r=(0,p.useRef)(n),a=(0,p.useCallback)((e=>{const{checked:s}=e.currentTarget;i.position.hideOtherSymbol({hideOtherSymbol:s,onlySymbol:t})}),[t,i.position]);return(0,p.useEffect)((()=>{r.current=n}),[n]),(0,p.useEffect)((()=>{r.current&&i.position.hideOtherSymbol({hideOtherSymbol:!0,onlySymbol:t})}),[t]),(0,s.jsxs)(ge.Z,Object.assign({sx:{fontSize:[1,0],color:"t.third",cursor:["auto","auto","pointer"],lineHeight:["unset","24px","24px"]}},{children:[(0,s.jsx)(ye.Z,{checked:n,onChange:a}),(0,s.jsx)(v.Z,Object.assign({sx:{userSelect:"none"}},{children:e("hideOtherSymbol",{defaultValue:"Hide Other Symbol"})}))]}))}));var xe=i(81913),fe=i(91531),je=i(94343),ve=i(25698),Pe=i(31677);const ke={pt:"xs",flexDirection:"column",alignItems:"center",textAlign:"center","& .title":{mt:"md",color:"t.primary"},"& .fail-info":{pt:"xs",mb:"md",width:"100%",maxHeight:304,overflowY:"auto","& .fail-order":{flexDirection:"column",mb:10},"& .symbol-wrap":{justifyContent:"center",alignItems:"center",mb:"2px","&.buy":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"buy"}},"&.sell":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"sell"}}},"& .symbolText":{display:"flex",alignItems:"center",mx:"minor"},"& .symbol":{mr:"minor"}}},Oe=({variant:e,className:t,children:i,color:n,whiteSpace:r="pre-wrap"})=>(0,s.jsx)(v.Z,Object.assign({variant:e,className:t,color:n,sx:{whiteSpace:r}},{children:i})),Ce=p.memo((({orders:e,productMap:t,isCoinFutures:i})=>{const{getI18n:n}=S(),{getI18n:a}=(0,y.yk)();return(0,s.jsxs)(r.Z,Object.assign({sx:ke},{children:[(0,s.jsx)(ve.Z,{size:80}),(0,s.jsx)(v.Z,Object.assign({variant:"headline6",className:"title"},{children:a("ClosePositionsFailed")})),(0,s.jsx)("div",Object.assign({className:"fail-info"},{children:Object.values(e).map((({symbol:e,positionSide:o,amount:l,color:c,messages:d},u)=>{let m,p=e;const h=null==t?void 0:t[e],{baseAsset:g=""}=h||{},y=i?a("Cont",{defaultValue:"Cont"})||"Cont":g;return h&&(m=(0,Pe.H)(h,a)),(0,s.jsxs)(r.Z,Object.assign({className:"fail-order"},{children:[(0,s.jsxs)(r.Z,Object.assign({className:`symbol-wrap ${c}`},{children:[(0,s.jsx)("div",Object.assign({className:"symbolText"},{children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Oe,Object.assign({variant:"subtitle1",className:"symbol"},{children:m.symbol})),(0,s.jsxs)(Oe,Object.assign({variant:"body1"},{children:[m.contractTypeI18n," ",m.deliveryDateFormat]}))]}):(0,s.jsx)(Oe,Object.assign({variant:"subtitle1"},{children:p}))})),(0,s.jsx)(Oe,Object.assign({variant:"subtitle1",color:c},{children:"LONG"===o?n("psLong",{defaultValue:"Long"}):n("psShort",{defaultValue:"Short"})}))]})),d.map(((e="")=>(0,s.jsx)(v.Z,Object.assign({variant:"body2",color:"t.primary",mt:"3px"},{children:e.replace(/%unit%/,y)}),e)))]}),u)}))})),(0,s.jsx)(P.Z,Object.assign({sz:"large",width:"100%",onClick:()=>je.ZP.close()},{children:a("OK")}))]}))}));var Se=i(6247);const Me=({hideOtherSymbol:e=!1})=>{const t="light"===(0,x.Fg)(),i="traditional",n=(0,x.AM)(),[a]=(0,x.z4)(),{isDelivery:o}=(0,p.useContext)(W),{getI18n:l}=S(),{getI18n:c}=(0,y.ZK)("trd-openOrder"),d=(0,p.useMemo)((()=>e?{symbolList:[a],newOrderRespType:"RESULT"}:{newOrderRespType:"RESULT"}),[e,a]),u=(0,p.useCallback)((()=>{try{(async e=>(0,O.v_)("/bapi/futures/v2/private/future/order/clear-position",e))(d).then((e=>{const{success:r,data:{failedOrderRespList:a=[]}}=e||{};if(r&&a.length){const e=(0,Se.QN)(a);je.ZP.show({isLight:t,color:i,sx:{minWidth:"360px",maxWidth:"360px"},onPressEnter:u,onPressEsc:()=>je.ZP.close(),children:(0,s.jsx)(Ce,{orders:e,productMap:n,isCoinFutures:o})})}je.ZP.close()}))}catch(e){je.ZP.close()}}),[d,t,n,o,i]),m=(0,p.useCallback)((()=>{je.ZP.close()}),[]);return(0,p.useCallback)((n=>{var o;null===(o=null==n?void 0:n.stopPropagation)||void 0===o||o.call(n),je.ZP.show({isLight:t,color:i,showCloseIcon:!1,sx:{width:["300px","360px"],height:"auto"},onPressEnter:()=>je.ZP.close(),onPressEsc:()=>je.ZP.close(),children:(0,s.jsxs)(T.Z,{children:[(0,s.jsxs)(T.Z,Object.assign({px:1,pt:[0,"16px"],sx:{textAlign:"center"}},{children:[(0,s.jsx)(fe.Z,{size:[60,96]}),(0,s.jsx)("div",{children:e?l("closePositionTextPartial",{symbol:a,defaultValue:"Are you sure you want to close all positions of {{symbol}} at market price?"}):l("closePositionText",{defaultValue:"Are you sure you want to close all your positions at market price?"})})]})),(0,s.jsxs)(r.Z,Object.assign({mt:"24px"},{children:[(0,s.jsx)(P.Z,Object.assign({sx:{width:.5,mr:3},sz:"l",flexGrow:1,colorStyle:"secondary",onClick:m},{children:c("dialog-cancel",{defaultValue:"Cancel"})})),(0,s.jsx)(P.Z,Object.assign({sx:{width:.5},sz:"l",flexGrow:1,onClick:u},{children:c("dialog-confirm",{defaultValue:"Confirm"})}))]}))]})})}),[c,l,u,e,t,a,i,m])},Te=({canPlaceOrder:e,closeTip:t})=>{const{getI18n:i,t:n}=(0,y.yk)(),r=Me({hideOtherSymbol:!1}),a=(0,p.useMemo)((()=>({width:"231px",color:"#1E2329",".btn-area":{mt:"4px",display:"flex",justifyContent:"flex-end",alignItems:"center",".text":{fontSize:"14px",fontWeight:500,cursor:"pointer"},".white":{ml:"18px",backgroundImage:"none","&:hover":{backgroundImage:"none"}}}})),[]);return(0,s.jsxs)(T.Z,Object.assign({sx:a},{children:[(0,s.jsxs)("div",Object.assign({className:"text"},{children:[i("service-abnormal",{defaultValue:"The service is currently overloaded or malfunctioning. "})," "," ",e&&(0,s.jsx)(L.c,{t:n,i18nKey:"futures-trade-abnormal-close-all",components:{bold:(0,s.jsx)("span",{style:{fontWeight:"bold"}})},defaults:"<bold>Cancel all open orders</bold> and <bold>close all positions</bold> here."})]})),e?(0,s.jsxs)("div",Object.assign({className:"btn-area"},{children:[(0,s.jsx)(v.Z,Object.assign({className:"text",onClick:t},{children:i("cancelBtnText",{defaultValue:"Cancel"})})),(0,s.jsx)(P.Z,Object.assign({className:"white",onClick:()=>{r(null),t()}},{children:i("confirmBtn",{defaultValue:"Confirm"})}))]})):(0,s.jsx)("div",Object.assign({className:"btn-area"},{children:(0,s.jsx)(P.Z,Object.assign({className:"white",onClick:t},{children:i("OK",{defaultValue:"OK"})}))}))]}))},we=({btnText:e})=>{const t=(0,x.Xb)(),i=Me({hideOtherSymbol:t});return(0,s.jsx)(P.Z,Object.assign({onClick:i,variant:"quiet",sz:"s",pl:"0"},{children:e}))},Ke=p.memo((({tip:e,title:t})=>{const{headers:i}=(0,p.useContext)(W),n=b.$f,[r,a]=(0,p.useState)(document.getElementById("position-pc"));(0,p.useEffect)((()=>{a(null)}),[i]),(0,p.useEffect)((()=>{a(document.getElementById("position-pc"))}),[n,r]);const o=(0,x.Dj)(),l=(null==o?void 0:o.length)||0,c=(0,x.zk)("abnormal"),d=(0,x.zk)("openTip"),u=(0,x.zk)("placeOrder"),m=(0,h.I0)(),g=(0,p.useCallback)((()=>m.serviceStatus.updateStateImmutable({openTip:!1})),[]),{activeTab:y}=(0,x.TH)();return"0"!==y?null:c?(0,s.jsx)("div",Object.assign({style:{width:"fit-content",position:"relative"}},{children:(0,s.jsx)(xe.Z,Object.assign({container:r,open:d,arrow:!0,boundary:document.body,bg:"primary",placement:"top-start",tip:(0,s.jsx)(Te,{canPlaceOrder:u,closeTip:g})},{children:e?(0,s.jsx)(we,{btnText:t}):(0,s.jsx)(v.Z,Object.assign({sx:{fontSize:0,color:"t.secondary"}},{children:t}))}))})):e?(0,s.jsx)(q.m,Object.assign({tip:e},{children:l?(0,s.jsx)(we,{btnText:t}):t})):(0,s.jsx)(v.Z,Object.assign({sx:{fontSize:0,color:"t.secondary"}},{children:t}))})),Ne=p.memo((()=>{const{getI18n:e}=S();return(0,s.jsxs)("div",Object.assign({className:"action-bar"},{children:[(0,s.jsx)(be,{}),(0,s.jsx)(we,{btnText:e("closePosition")||""})]}))}));var ze=i(40590),Ze=i(36829),Ae=i(86041),Ie=i(54813);const Ve=e=>{const{getI18n:t}=S(),{qty:i,qtyError:n,defaultQty:a,qtyStep:o,handleAmountChange:l,onConfirm:c,baseAsset:d="BTC",positionSize:u}=e,m=Math.abs(u),p=(0,s.jsx)(r.Z,Object.assign({sx:{mr:"6px",color:"t.yellow200"}},{children:(0,s.jsx)(T.Z,{children:d})}));return(0,s.jsx)(T.Z,{children:(0,s.jsx)(N.Z,{variant:"outline",value:i,defaultValue:a,step:o,onChange:l,onKeyDown:e=>(0,z.f5)(e,c),onBlur:e=>(0,z.Y5)(e),error:n,placeholder:String(m),prefix:(0,s.jsx)(T.Z,Object.assign({sx:{ml:2,color:"t.grey300"}},{children:t("Amount",{defaultValue:"Amount"})})),suffix:p,sx:{textAlign:"right"},boxProps:{width:"100%",mt:"8px",borderRadius:"2px"}})})},Re=e=>{const{getI18n:t}=S(),{isMarket:i,price:n,priceError:a,handlePriceChange:o,initialMarkPrice:l,quoteAsset:c="USDT",priceStep:d}=e,u=i?"":l,m=t("price",{defaultValue:"Price"}),p=(0,s.jsxs)(r.Z,Object.assign({sx:{mr:1,width:i?"95px":"auto"}},{children:[i&&(0,s.jsx)(r.Z,Object.assign({flex:1},{children:t("Market",{defaultValue:"Market"})})),(0,s.jsx)(T.Z,{children:c})]}));return(0,s.jsx)(T.Z,{children:(0,s.jsx)(N.Z,{variant:"outline",labelFixed:!0,disabled:i,value:n,step:d,error:a,onChange:o,placeholder:u,defaultValue:l,prefix:(0,s.jsx)(T.Z,Object.assign({sx:{ml:2,color:"t.grey300"}},{children:m})),suffix:p,sx:{textAlign:"right"},boxProps:{width:"100%",mt:"8px",borderRadius:"2px"}})})},Le=({onClick:e,sx:t,children:i})=>(0,s.jsx)(r.Z,Object.assign({justifyContent:"center",alignItems:"center",sx:Object.assign({display:"flex",flex:"1",minWidth:"40px",height:"24px",border:"1px solid",borderColor:"position.percentInputBorderColor",borderRadius:"2px",cursor:"pointer",mr:"4px",color:"t.third",bg:"bg3",textAlign:"center",":hover":{color:["t.yellow","t.yellow","t.primary"],bg:["bg3","bg3","line"],borderColor:"currentColor"},":last-of-type":{mr:0}},t),onClick:e},{children:i})),qe=({percents:e=[.1,.25,.5,.75,1],onChange:t=(e=>{}),sx:i={},percentSx:n={}})=>(0,s.jsx)(r.Z,Object.assign({variant:"dropdown",justifyContent:"space-between",sx:Object.assign({width:"100%",bg:"popupBg",borderRadius:"4px",p:"8px"},i)},{children:e.map((e=>(0,s.jsxs)(Le,Object.assign({sx:n,onClick:()=>t(e)},{children:[100*e,"%"]}),e)))}));var Ee=i(77991),De=i(65871),Ue=i(93112),$e=i(31050),Fe=i(25769),Be=i(4303),He=i(23971),We=i(30271),Qe=i(63884);const _e={symbol:130,size:90,notionalSize:110,entryPrice:100,markPrice:100,liquidationPrice:90,marginRatio:110,margin:90,pnl:145,adl:75,closePosition:235,tpSl:130},Ge=e=>({width:`${e}px`,flex:`1 0 ${e}px`}),Ye={flexDirection:"column",height:"100%",flex:"1 0",overflowX:"auto",overflowY:"hidden",".action-bar":{display:"flex",alignItems:"center",justifyContent:"flex-end",position:"absolute",top:0,right:"16px",zIndex:"999",height:"40px","&.fullscreen":{right:"12px"}},".position-row":{my:0,py:0,display:"flex",alignItems:"center",flex:"none",color:"t.secondary",fontSize:[0],cursor:"auto",width:"100%",height:"40px",boxSizing:"border-box",borderBottom:"1px solid",borderBottomColor:"newLine","&.header":{height:"32px"},"& .header-item":{display:"flex",alignItems:"center","& .drag-icon":{display:"none",ml:"4px",color:"t.third",cursor:"move","&:hover":{color:"t.primary"}},"& .rank-icon":{display:"none",ml:"2px",transform:"scale(1.6)",pointerEvents:"none",flex:"none"},"&:hover .drag-icon, &:hover .rank-icon":{display:"inline"},"&.show-ranking .rank-icon":{display:"inline"}},"&.body":{":hover":{backgroundColor:"bg3",".symbol":{color:"t.yellow",".symbolRightArrow":{display:"block"}}},".symbol":{display:"flex",alignItems:"center",cursor:"pointer",".symbolRightArrow":{display:"none"},".bar":{width:4,height:"39px",mr:"4px","&-buy":{bg:"buy"},"&-sell":{bg:"sell"},"&-liq":{bg:"t.secondary"}},".leverage":{color:"t.yellow",bg:"tagBg",fontSize:"12px",ml:"4px",borderRadius:"2px",px:"minor"}},".size":{"&-buy":{color:"t.buy"},"&-sell":{color:"t.sell"},"&-liq":{color:"t.secondary"}},".liquidationPrice":{color:"t.emphasize",".liqRefresh":{cursor:"pointer"}},".marginRatio":{"&-negative ":{color:"negative"}},".margin":{display:"flex",alignItems:"center","&-text":{whiteSpace:"nowrap",mr:"4px"},"&-icon-container":{position:"relative",".red-point":{width:"6px",height:"6px",bg:"sell",borderRadius:"50%",top:"-3px",right:"-3px",position:"absolute"}}},".pnl":{display:"flex",alignItems:"center","&-buy ":{color:"t.buy"},"&-sell ":{color:"t.sell"}},".tpSl":{display:"flex",alignItems:"center","&-text":{mr:"4px"}}},".symbol":Object.assign({},Ge(_e.symbol)),".size":Object.assign({},Ge(_e.size)),".notionalSize":Object.assign({},Ge(_e.notionalSize)),".entryPrice":Object.assign({},Ge(_e.entryPrice)),".markPrice":Object.assign({},Ge(_e.markPrice)),".liquidationPrice":Object.assign({},Ge(_e.liquidationPrice)),".marginRatio":Object.assign({},Ge(_e.marginRatio)),".margin":Object.assign({},Ge(_e.margin)),".pnl":Object.assign({},Ge(_e.pnl)),".adl":Object.assign({},Ge(_e.adl)),".closePosition":Object.assign({},Ge(_e.closePosition)),".tpSl":Object.assign({},Ge(_e.tpSl))}},Je={minWidth:"228px",bg:"popupBg",borderRadius:"4px",px:"16px",py:"4px",maxHeight:"138px",overflow:"auto",boxShadow:"0px 0px 10px rgba(0,0,0,0.3)",".order":{color:"t.primary",fontSize:"12px",lineHeight:"16px",height:"32px",borderBottom:"solid 1px",borderColor:"line",justifyContent:"space-between",alignItems:"center","&:last-of-type":{border:"none"},".order-icon":{cursor:"pointer",color:"t.third","&:hover path":{fill:"t.primary"}}},".cancel":{color:"t.yellow200",cursor:"pointer",":hover":{color:"t.yellow300"}}},Xe={height:"24px",mt:0,input:{p:"4px",fontSize:"12px"}};function et({orders:e=[],symbol:t,handleCancel:i}){const n=(0,x.AM)(),{isDelivery:a}=(0,p.useContext)(W),o=n[t]||{},{marginAsset:l,pricePrecision:c,quantityPrecision:d,equalQtyPrecision:u,contractVal:m}=o,{getI18n:h}=(0,Be.yk)(),{getI18n:g}=(0,Be.ZK)("trd-openOrder",undefined);const{isCoinUnit:y}=(0,He.QV)(),{getFormatedQuantity:b}=(0,Qe.s7)(o);return e.length?(0,s.jsx)(T.Z,Object.assign({sx:Je},{children:e.map((e=>(0,s.jsxs)(r.Z,Object.assign({className:"order"},{children:[(0,s.jsxs)(v.Z,Object.assign({sx:{mr:"43px",color:"position.limitOrdersColor"}},{children:[a?y?(0,We.unitChangeCoinQty)({quantity:e.origQty,contractVal:m,price:e.price,precision:u}):(0,R.uf)(e.origQty,d):b({quantity:e.origQty,price:e.price,qtyPrecision:d})," ",a?y?l:h("Cont",{defaultValue:"Cont"}):""," ",h("toBeClosedAt",{defaultValue:"to be closed at"})," ",(0,R.uf)(e.price,c)]})),(0,s.jsx)(Fe.Z,{className:"order-icon",size:20,onClick:()=>{i(e.orderId)}})]}),e.orderId)))})):null}var tt=i(89865),it=i(59560);const st=({sideKey:e,qty:t,isDelivery:i,isCoinUnit:s,isUsdtFuturesUSDTUnit:n,positionSize:r,stepSizePrecision:a,tickSizePrecision:o,equalQtyPrecision:l})=>{const{quantityAmount:c}=(0,J.v_)({sideKey:e}),d=Math.abs(Number(c.replace("-",""))),u=Number(t)/Math.abs(r)*d;let m=a;return i&&s?m=l:!i&&n&&(m=o),(0,R.yd)(u,m,1)},nt=e=>{var t,i;const{getI18n:s}=S(),{getI18n:n}=(0,y.yk)(),{enqueueNotification:r}=(0,a.Z)(),{orderConfirmation:o}=(0,x.F7)(),{isCoinUnit:l}=(0,He.QV)(),{isUSDTUnit:c}=(0,tt.Q)(),{actionPlaceOrder:d,actionOrderConfirmModal:u,isDelivery:m}=(0,p.useContext)(W),h=(0,p.useRef)(null),g=(0,x.t2)(e,"symbol"),b=(0,x.t2)(e,"positionSize"),f=(0,x.t2)(e,"positionSide"),j=(0,x.t2)(e,"initialMarkPrice"),v=(0,x.t2)(e,"selectPrice"),P=(0,x.AM)()[g]||{},{filters:k=[],baseAsset:O,tickSize:C=.01,limitStepSize:M=.001,equalQtyPrecision:T}=P,w=k&&(null===(t=k.find(it.W4))||void 0===t?void 0:t.maxQty),K=k&&(null===(i=k.find(it.vr))||void 0===i?void 0:i.maxQty),N=(0,$e.p)(C),[A,I]=(0,p.useState)(Number(j).toFixed(N)),V=0===Number(A),L=(0,$e.p)(M),[q,E]=(0,p.useState)(!1),D=m?0:L,U=(0,R.yd)(Math.abs(b),D,1),[$,F]=(0,p.useState)(U),B=Number($)>Math.abs(b),H=m?n("Cont"):O,Q=C,_=(0,Z.nH)(D);(0,p.useEffect)((()=>{v&&I(String(v))}),[v]),(0,p.useEffect)((()=>{q||F(U)}),[q,U]);const G=(0,Ue.D)((({orderType:t})=>{var i;const s=Number($);if(!(null==h?void 0:h.current)||!s)return;const n=()=>{d({symbol:g,type:t,side:b>0?"SELL":"BUY",quantity:s,price:A,positionSide:f})},r={orderType:t,limitPrice:A,qty:Number(null===(i=null==h?void 0:h.current)||void 0===i?void 0:i.preferredUnitQty),quantity:s};o[t]?u(e,r,n):n()})),Y=(0,Ue.D)((()=>{if(K&&Number($)>Number(K))return r({header:s("maxPromptTitle",{defaultValue:"Quantity Failed"}),message:`${s("maxMarketQty",{defaultValue:"Maximum Market Order Quantity"})}: ${K} ${H}`,autoHideDuration:1e4}),"";G({orderType:"MARKET"})})),J=(0,Ue.D)((()=>V?"":w&&Number($)>Number(w)?(r({header:s("maxPromptTitle",{defaultValue:"Quantity Failed"}),message:`${s("maxLimitQty",{defaultValue:"Maximum Limit Order Quantity"})}: ${w} ${H}`,autoHideDuration:1e4}),""):void G({orderType:"LIMIT"})));return{symbol:g,initialMarkPrice:j,defaultQty:U,qty:$,qtyError:B,qtyStep:_,priceError:V,price:A,priceStep:Q,nullRef:h,handlePriceChange:e=>(0,z._p)(e,(e=>I(e)),null,N),handleAmountChange:e=>{(0,z._p)(e,(e=>F(e)),null,D),E(!0)},handlePercentageClick:e=>{F((0,R.yd)(e*Math.abs(b),D,1)),E(!0)},onMarketClick:Y,onLimitClick:J,quantityObj:{sideKey:e,isDelivery:m,isCoinUnit:l,isUsdtFuturesUSDTUnit:c,qty:$,positionSize:b,stepSizePrecision:L,tickSizePrecision:N,equalQtyPrecision:T}}},rt=(0,p.forwardRef)((({sideKey:e,isDelivery:t,isCoinUnit:i,isUsdtFuturesUSDTUnit:s,qty:n,positionSize:r,stepSizePrecision:a,tickSizePrecision:o,equalQtyPrecision:l},c)=>{const d=st({sideKey:e,qty:n,isDelivery:t,isCoinUnit:i,isUsdtFuturesUSDTUnit:s,positionSize:r,stepSizePrecision:a,tickSizePrecision:o,equalQtyPrecision:l});return(0,p.useImperativeHandle)(c,(()=>({preferredUnitQty:d}))),null})),at=({qty:e,symbol:t,positionSize:i,isUsdtFuturesUSDTUnit:n,isCoinUnit:r,isDelivery:a,sideKey:o,stepSizePrecision:l,tickSizePrecision:c,equalQtyPrecision:d})=>{const{getI18n:u,t:m}=(0,y.yk)(),p=Math.abs(i),h=(0,x.AM)()[t]||{},{baseAsset:g,quoteAsset:b}=h,f=a?u("Cont",{defaultValue:"Cont"}):g,j=a?g:b,v=e,P=st({sideKey:o,qty:e,isDelivery:a,isCoinUnit:r,isUsdtFuturesUSDTUnit:n,positionSize:i,stepSizePrecision:l,tickSizePrecision:c,equalQtyPrecision:d});return a&&r||!a&&n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:m("closePosition-qtyTip-positionSize",{defaultValue:"Position Size: {{positionSize}} {{orderUnit}}",positionSize:p,orderUnit:f})}),(0,s.jsx)("div",{children:m("closePosition-qtyTip-unitConversion",{defaultValue:"Qty: {{orderQty}} {{orderUnit}} ≈ {{preferredUnitQty}} {{preferredUnit}}",orderQty:v,orderUnit:f,preferredUnitQty:P,preferredUnit:j})})]}):(0,s.jsx)(s.Fragment,{children:m("closePosition-qtyTip-unit",{defaultValue:"Qty: {{orderUnit}}",orderUnit:f})})},ot=p.memo((({sideKey:e})=>{const{getI18n:t}=S(),{getI18n:i}=(0,y.yk)(),{symbol:n,initialMarkPrice:a,defaultQty:o,qty:l,qtyError:c,qtyStep:d,priceError:u,price:m,priceStep:h,nullRef:g,quantityObj:b,handlePriceChange:f,handleAmountChange:j,handlePercentageClick:v,onMarketClick:k,onLimitClick:O}=nt(e),{handleCancel:C,placedOrdersLength:M,placedOrders:T}=(e=>{const t=(0,x.t2)(e,"symbol"),i=(0,x.t2)(e,"positionSize"),s=(0,x.t2)(e,"positionSide"),{preOrders:n}=(0,x.E)(),r=n.filter((e=>e.reduceOnly&&"LIMIT"===e.type&&e.symbol===t&&e.positionSide===s&&e.side===(i>0?"SELL":"BUY"))),a=r.length,{actionCancelOrder:o}=(0,p.useContext)(W);return{handleCancel:e=>{e&&o(e)},placedOrdersLength:a,placedOrders:r}})(e);return(0,s.jsxs)(r.Z,Object.assign({alignItems:"center",width:"100%",sx:{flexGrow:2}},{children:[(0,s.jsx)(P.Z,Object.assign({variant:"text",sx:{pl:0,pr:"8px",fontSize:"12px"},onClick:k},{children:t("market",{defaultValue:"Market"})})),(0,s.jsx)(Ee.ZP,Object.assign({trigger:"hover",enablePortal:!0,placement:"top",sx:{minWidth:"auto"},overlay:(0,s.jsx)(et,{orders:T,symbol:n,handleCancel:C})},{children:(0,s.jsx)(P.Z,Object.assign({variant:"text",sx:{px:"8px",fontSize:"12px",borderRadius:"0",borderLeft:"1px solid",borderLeftColor:"newLine"},onClick:O},{children:`${t("limit",{defaultValue:"Limit"})}${M>0?`(${M})`:""}`}))})),(0,s.jsx)(De.Z,Object.assign({enablePortal:!0,placement:"top",arrow:!0,tip:(0,s.jsx)("div",{children:u?i("invalid-price",{defaultValue:"Invalid Price"}):t("price",{defaultValue:"Price"})})},{children:(0,s.jsx)(N.Z,{variant:"filled",boxProps:{sx:Xe},type:"number",value:m,step:h,error:u,onChange:f,defaultValue:a})})),(0,s.jsx)(Ee.ZP,Object.assign({trigger:"click",enablePortal:!0,placement:"bottom-end",sx:{mx:"4px"},overlay:(0,s.jsx)(qe,{sx:{width:"230px"},onChange:v})},{children:(0,s.jsx)(De.Z,Object.assign({enablePortal:!0,placement:"top",arrow:!0,tip:(0,s.jsx)(at,Object.assign({},b,{symbol:n}))},{children:(0,s.jsx)(N.Z,{variant:"filled",boxProps:{sx:Xe},value:l,error:c,onChange:j,defaultValue:o,step:d})}))})),(0,s.jsx)(rt,Object.assign({ref:g},b))]}))})),lt=p.memo((({sideKey:e,panelType:t,onClose:i})=>{var n;const{symbol:r,initialMarkPrice:a,defaultQty:o,qtyError:l,qty:c,qtyStep:d,priceError:u,price:m,priceStep:h,nullRef:g,quantityObj:b,handlePriceChange:f,handleAmountChange:j,handlePercentageClick:v,onMarketClick:k,onLimitClick:O}=nt(e),{getI18n:C}=S(),{getI18n:M}=(0,y.yk)(),{isDelivery:w}=(0,p.useContext)(W),K=(0,x.t2)(e,"positionSize"),N=(0,x.t2)(e,"entryPrice"),z=(null===(n=(0,x.AM)())||void 0===n?void 0:n[r])||{},{baseAsset:Z,quoteAsset:A,contractVal:I}=z,V="MARKET"===t,{marketPNL:R,limitPNL:L}=function({symbol:e,quantity:t,isBuy:i,entryPrice:s=0,closedPrice:n=0,contractVal:r=100,isDelivery:a}){const o=function({symbol:e,isDelivery:t}){const{value:i=(e?{}:[])}=(0,Q.N)((()=>t?G(e):_(e)),[e,t]);return i}({symbol:e,isDelivery:a}),{askPrice:l=0,bidPrice:c=0}=o;return(0,p.useMemo)((()=>(0,Y.k)({quantity:t,isBuy:i,entryPrice:s,closedPrice:n,contractVal:r,isDelivery:a,askPrice:l,bidPrice:c})),[l,c,n,r,s,i,a,t])}({symbol:r,quantity:Number(c),isBuy:K>0,entryPrice:N,closedPrice:m||a,contractVal:I,isDelivery:w}),q=V?R:L,E=()=>{i(),V?k():O()};return(0,s.jsxs)(T.Z,Object.assign({mt:"md"},{children:[(0,s.jsx)(rt,Object.assign({ref:g},b)),(0,s.jsx)(Re,{isMarket:V,price:m,priceError:u,priceStep:h,handlePriceChange:f,initialMarkPrice:a,quoteAsset:A}),(0,s.jsx)(Ve,{qty:c,qtyError:l,defaultQty:o,qtyStep:d,positionSize:K,baseAsset:w?M("Cont",{defaultValue:"Cont"}):Z,handleAmountChange:j,onConfirm:E}),(0,s.jsx)(qe,{sx:{bg:"transparent",px:0},percentSx:{height:"32px",mr:"8px"},onChange:v}),(0,s.jsxs)(T.Z,Object.assign({sx:{mt:"plus",mb:"24px",lineHeight:"34px"}},{children:[(0,s.jsxs)(T.Z,Object.assign({color:"t.third",as:"span"},{children:[C("estimatedPNL",{defaultValue:"Estimated PNL"}),":"]})),(0,s.jsxs)(T.Z,Object.assign({sx:{float:"right"}},{children:[isNaN(Number(q))?"-":(0,Ie.uf)(q,w?4:2)," ",A]}))]})),(0,s.jsx)(P.Z,Object.assign({disabled:!1,sz:"l",width:1,onClick:E},{children:C("confirm",{defaultValue:"Confirm"})}))]}))})),ct=({active:e,title:t})=>{const i=(0,s.jsx)(T.Z,{sx:{width:"100%",height:"2px",bg:"primary",position:"absolute",bottom:"-1px"}});return(0,s.jsxs)(T.Z,Object.assign({sx:{position:"relative",mr:"16px",pt:"2px",pb:"14px",fontSize:"16px",fontWeight:"medium"},color:e?"t.primary":"t.grey300"},{children:[t," ",e?i:null]}))},dt=p.memo((({open:e,curSideKey:t,onClose:i})=>{const[n,r]=(0,p.useState)("MARKET"),{getI18n:a}=S(),o=(0,p.useCallback)((e=>{r(e)}),[r]);return(0,s.jsx)(ze.Z,Object.assign({open:e,onCloseIconClick:i,containerSx:{alignItems:"flex-end"},sx:{width:["100%","464px"],height:"auto",position:["relative","absolute"],top:["auto","50%"],transform:["none","translateY(-50%)"]},closeSx:{zIndex:1}},{children:(0,s.jsxs)(Ze.Z,Object.assign({lazy:!0,defaultActiveKey:n,onChange:o,tabsSx:{borderBottom:"1px solid",borderBottomColor:"lines.primary",overflow:"visible"}},{children:[(0,s.jsx)(Ae.Z,Object.assign({tab:e=>(0,s.jsx)(ct,{active:e,title:a("MarketClose",{defaultValue:"Market Close"})}),tabKey:"MARKET"},{children:(0,s.jsx)(lt,{panelType:"MARKET",sideKey:t,onClose:i})})),(0,s.jsx)(Ae.Z,Object.assign({tab:e=>(0,s.jsx)(ct,{active:e,title:a("LimitClose",{defaultValue:"Limit Close"})}),tabKey:"LIMIT"},{children:(0,s.jsx)(lt,{panelType:"LIMIT",sideKey:t,onClose:i})}))]}))}))}));var ut=i(66689),mt=i(415);const pt=e=>p.createElement(mt.Z,{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...e},p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.314 4.781l3.889 3.89-1.768 1.767-3.889-3.889 1.768-1.768zm-3.182 3.182l3.89 3.89-5.129 5.127H15v3H7.893l-.004.004H4v-3.889l8.132-8.132zM17 16.98h3v3h-3v-3z",fill:"currentColor"}));var ht=i(88469),gt=i.n(ht);const yt=e=>p.createElement(mt.Z,{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...e},p.createElement("path",{d:"M9 14.5A6.5 6.5 0 0115.5 8h1.672l-2.586 2.586L16 12l5-5-5-5-1.414 1.414L17.172 6H15.5A8.5 8.5 0 007 14.5V17h2v-2.5z",fill:"currentColor"}),p.createElement("path",{d:"M19 15h2v6H3v-6h2v4h14v-4z",fill:"currentColor"})),bt=(0,p.lazy)((()=>Promise.all([i.e(7003),i.e(9876)]).then(i.bind(i,49876)))),xt={display:"flex",alignItems:"center",cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},ft={display:"flex",alignItems:"center"},jt=({text:e,onClick:t,sx:i,showTip:n=!1,showIcon:r=!0})=>{const{t:a}=(0,y.yk)(),o=(0,p.useMemo)((()=>gt()({},xt,i)),[i]),l=(0,s.jsxs)(T.Z,Object.assign({sx:o,onClick:t},{children:[r&&(0,s.jsx)(yt,{className:"share-icon",ml:"4px",mr:e?"4px":"0px",size:16}),e]}));return n?(0,s.jsx)(xe.Z,Object.assign({sx:ft,arrow:!0,tip:a("share",{defaultValue:"Share"})},{children:l})):l},vt=(0,p.memo)((({btnText:e,btnSx:t,sideKey:i,showIcon:n,onClickIcon:r})=>{const[a,o]=(0,p.useState)(!1),l=(0,p.useCallback)((()=>{r&&r(),o(!0)}),[r]),c=(0,p.useCallback)((()=>{o(!1)}),[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(jt,{sx:t,text:e,showIcon:n,onClick:l}),(0,s.jsx)(p.Suspense,Object.assign({fallback:(0,s.jsx)(he.Z,{})},{children:a&&(0,s.jsx)(bt,{visible:a,onClose:c,sideKey:i})}))]})})),Pt=i(24843).BA[400],kt=({filled:e})=>{const t=e?Pt:"transparent";return(0,s.jsx)(T.Z,{__css:{display:"inline-block",width:"4px",height:"14px",mx:"1px",border:`1px solid ${Pt}`,bg:t}})},Ot=e=>{var{adl:t=0,dashed:i=!1}=e,n=(0,f._T)(e,["adl","dashed"]);return(0,s.jsxs)(T.Z,Object.assign({},n,{sx:{borderBottom:i?`1px dashed ${Pt}`:"none"}},{children:[Array(t).fill(0).map(((e,t)=>(0,s.jsx)(kt,{filled:!0},t))),Array(4-t).fill(0).map(((e,t)=>(0,s.jsx)(kt,{filled:!1},t)))]}))};var Ct=i(24047);const St=()=>{const[e,t]=(0,p.useState)(!1),i=(0,h.I0)(),s=(0,b.nM)(),{isError:n}=(0,h.v9)(Ct.Y),r=(0,x.Kc)("isError"),a=n||r,o=(0,p.useCallback)((()=>(0,f.mG)(void 0,void 0,void 0,(function*(){if(!e){t(!0);try{yield i.balance.getBalance(s),yield i.bracket.getBrackets()}catch(e){t(!1)}t(!1)}}))),[i.balance,i.bracket,s,e]);return(0,p.useMemo)((()=>({showLiqRefresh:a,handleLiqRefresh:o})),[o,a])};var Mt=i(43326),Tt=i(18262);const wt=({sideKey:e,columnKey:t=""})=>{const i=(0,x.KQ)(),s=(0,x.Gf)(),n=(0,x.F)(),r=(0,x.cO)(e)||{},a=(0,re.ZP)(re.hZ),{symbol:o,positionSide:l}=r,c=(0,x.AM)()[o]||{},{marginAsset:d,pricePrecision:u}=c,m=i[d]||{},{crossWalletBalance:h=0}=m,g=(null==s?void 0:s[o])||[],{assetsRateEquity:y,assetsMM:b}=(0,x.Nx)(),f=(0,x.G8)(),j=f[d]||{},v=((0,Se.L6)(n)[d]||[]).filter((e=>(null==e?void 0:e.symbol)!==o)),P=(0,Mt.zW)(v,s),k=(0,Mt.ot)(v);let O=0;Object.entries(y).forEach((([e,t])=>{e!==d&&(O+=t)})),Object.entries(b).forEach((([e,t])=>{const i=f[e]||{},{askRate:s=0}=i;O-=e!==d?t*s:P*s}));let C=0;if(l&&"BOTH"!==l){const e=n.filter((e=>{const{symbol:t,positionSide:i}=e||{};return t===o&&"BOTH"!==i&&i!==l}))[0]||{positionSize:0,entryPrice:0},t="LONG"===l?r:e,i="SHORT"===l?r:e;C=(0,Tt._O)({accEquityAndMMs:O,assetIndex:j,bracket:g,crossWalletBalance:h,smdsUPNL:k,longPosition:t,shortPosition:i,curPosition:r})}else C=(0,Tt.Dj)({accEquityAndMMs:O,assetIndex:j,bracket:g,crossWalletBalance:h,smdsUPNL:k,curPosition:r});const S=C>0?(0,R.uf)(C,u):"-";return(0,p.useEffect)((()=>{t&&a(e,t,C)}),[]),{liquidationPrice:C,formatedLiqPrice:S}},Kt=({sideKey:e,columnKey:t=""})=>{const i=(0,re.ZP)(re.hZ),{riskRatio:s}=(0,x.Nx)(),n=Number(s)>80?"negative":"";return(0,p.useEffect)((()=>{t&&i(e,t,Number(s))}),[]),{ratioColor:n,riskRatio:s}},Nt=["size","notionalSize","entryPrice","markPrice","liquidationPrice","marginRatio","margin","pnl","tpsl"],zt=({children:e})=>(0,s.jsx)(v.Z,Object.assign({variant:"caption",color:"t.third"},{children:e})),Zt=({color:e,children:t})=>(0,s.jsx)(v.Z,Object.assign({variant:"captionSub",color:e||"t.primary"},{children:t})),At=({children:e,sx:t})=>(0,s.jsx)(r.Z,Object.assign({className:"row-item",sx:t},{children:e})),It=({sideKey:e,actionPlaceOrderModal:t})=>{const{getI18n:i}=S(),{color:n,symbolText:r,symbolName:a,leverage:o}=(0,J.iA)({sideKey:e}),l=(0,x.t2)(e,"positionSize"),c=(0,x.t2)(e,"adl"),d=(0,p.useCallback)((()=>{t(e)}),[t,e]);return(0,s.jsxs)(At,Object.assign({sx:{pb:"10px !important"}},{children:[(0,s.jsxs)("div",Object.assign({className:`symbol-wrap ${n}`},{children:[a?(0,s.jsxs)("div",Object.assign({className:"symbolText"},{children:[(0,s.jsx)("div",Object.assign({className:"symbol"},{children:a.symbol})),(0,s.jsx)("div",{children:`${a.contractTypeI18n} ${a.deliveryDateFormat}`})]})):(0,s.jsx)("div",Object.assign({className:"symbolText"},{children:r})),(0,s.jsx)("div",Object.assign({className:"leverage"},{children:`${o}x`})),(0,s.jsx)(Ot,{adl:c}),(0,s.jsx)(vt,{sideKey:e})]})),0===Number(l)?null:(0,s.jsx)(v.Z,Object.assign({className:"close-position",onClick:d},{children:i("closePositionSingle",{defaultValue:"Close Position"})}))]}))},Vt=({sideKey:e})=>{const{getI18n:t}=S(),{color:i,formatedQuantityAmount:n,unit:r}=(0,J.v_)({sideKey:e});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:t("uSizeDes",{defaultValue:"Trading units using stable coins in USDⓈ-M Futures such as USDT, open position amounts shown are calculated based on the actual coin quantity. Values change with the last price of the symbol."})},{children:t("size",{defaultValue:"Size"})})),(0,s.jsxs)(Zt,Object.assign({color:i},{children:[n," ",r]}))]})},Rt=({sideKey:e})=>{const{getI18n:t}=(0,y.yk)(),{formattedNotionalSize:i,unit:n}=(0,J.jK)({sideKey:e});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(zt,{children:t("notionalSize",{defaultValue:"Notional Size"})}),(0,s.jsxs)(Zt,{children:[i," ",n]})]})},Lt=({sideKey:e})=>{const{getI18n:t}=S(),{useLastPrice:i}=(0,x.F7)(),n=i?"lastPrice":"markPrice",{formatedPnl:r,pnlColor:a,ROEVal:o}=(0,J.qU)({sideKey:e});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:t(`unrealizedPnlTip-${n}`)},{children:t("m-unrealizedPnl",{defaultValue:"Unrealized PNL(ROE %)"})})),(0,s.jsx)(Zt,Object.assign({color:a},{children:`${r}(${o})`}))]})},qt=({sideKey:e})=>{const{getI18n:t}=S(),{formatedEntryPrice:i}=(0,J.A4)({sideKey:e});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:t("entryPriceTip",{defaultValue:"Average executed buy/sell price for your current long/short position."})},{children:t("entryPrice",{defaultValue:"Entry Price"})})),(0,s.jsx)(Zt,{children:i})]})},Et=({sideKey:e})=>{const{getI18n:t,i18n:{language:i}}=S(),{formatedMarkPrice:n}=(0,J.z1)({sideKey:e});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:t("markPriceTip",{defaultValue:"The latest mark price for this contract. This is the price used for PNL and margin calculations, and may differ from the last price for the purposes of avoiding price manipulation."}),learnMoreLink:(0,ut.C)(b.Wh.UM_MARK_PRICE,{locale:(0,ee.sU)(i)})},{children:t("markPrice",{defaultValue:"Mark Price"})})),(0,s.jsx)(Zt,{children:n})]})},Dt=({liquidationPrice:e,formatedLiqPrice:t})=>{const{showLiqRefresh:i,handleLiqRefresh:n}=St(),{getI18n:r,i18n:{language:a}}=S(),{getI18n:o}=(0,y.yk)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:r("liquidationPriceTip",{defaultValue:"If the mark price of the contract reaches below this price (when long) or above this price(when short), your position will be liquidated."}),learnMoreLink:(0,ut.C)(b.Wh.LIQ_PRICE,{locale:(0,ee.sU)(a)})},{children:r("m-liquidationPrice",{defaultValue:"Liquidation Price"})})),(0,s.jsx)(Zt,Object.assign({color:"t.emphasize"},{children:i?(0,s.jsx)("div",Object.assign({onClick:n},{children:o("refresh",{defaultValue:"Refresh"})})):e>0?t:"-"}))]})},Ut=({sideKey:e})=>{const{liquidationPrice:t,formatedLiqPrice:i}=(0,J.Mx)({sideKey:e});return(0,s.jsx)(Dt,{liquidationPrice:t,formatedLiqPrice:i})},$t=({sideKey:e})=>{const{liquidationPrice:t,formatedLiqPrice:i}=wt({sideKey:e});return(0,s.jsx)(Dt,{liquidationPrice:t,formatedLiqPrice:i})},Ft=({ratioColor:e,riskRatio:t})=>{const{getI18n:i}=S();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:i("marginRatioTip",{defaultValue:"The lower the Margin Ratio, the lower your liquidation level will be relative to your position size. Your positions will be liquidated once Margin Ratio reaches 100%."})},{children:i("marginRatio",{defaultValue:"Margin Ratio"})})),(0,s.jsxs)(Zt,Object.assign({color:e},{children:[t,"%"]}))]})},Bt=({sideKey:e})=>{const{ratioColor:t,riskRatio:i}=(0,J.ek)({sideKey:e});return(0,s.jsx)(Ft,{ratioColor:t,riskRatio:i})},Ht=({sideKey:e})=>{const{ratioColor:t,riskRatio:i}=Kt({sideKey:e});return(0,s.jsx)(Ft,{ratioColor:t,riskRatio:i})},Wt=({sideKey:e})=>{const{getI18n:t}=S(),{actionAdjustMarginModal:i}=(0,p.useContext)(W),n=(0,x.t2)(e,"positionSize"),a=(0,x.t2)(e,"isolated"),{formatedMargin:o}=(0,J.Yq)({sideKey:e}),l=a?t("headerIsolated",{defaultValue:"Isolated"}):t("header-Cross",{defaultValue:"Cross"}),c=(0,p.useCallback)((()=>{i(e)}),[i,e]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:t("marginTip",{defaultValue:"The margin allocated to the current position."})},{children:t("margin",{defaultValue:"Margin"})})),(0,s.jsxs)(r.Z,Object.assign({alignItems:"center"},a&&{onClick:c},{children:[(0,s.jsx)(v.Z,Object.assign({variant:"captionSub",color:"t.primary"},{children:`${o} (${l})`})),0===Number(n)?null:a?(0,s.jsx)(pt,{size:16,color:"t.third",ml:"4px"}):null]}))]})},Qt=({sideKey:e})=>{const{getI18n:t}=S(),{isDelivery:i,actionTpslModal:n}=(0,p.useContext)(W),{formatedTPPrice:a,formatedSLPrice:o}=(0,J.Mn)({sideKey:e}),l=(0,p.useCallback)((()=>{n(e)}),[n,e]);return i?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.m,Object.assign({tip:t("tpSlTip")},{children:t("tpSl",{defaultValue:"TP/SL"})})),(0,s.jsxs)(r.Z,Object.assign({display:"inline-flex",alignItems:"center",justifyContent:"flex-end",onClick:l},{children:[(0,s.jsxs)(v.Z,Object.assign({variant:"captionSub",color:"t.primary"},{children:[a," / ",o]})),(0,s.jsx)(pt,{size:16,color:"t.third",ml:"4px"})]}))]})},_t=(0,p.memo)((({sideKey:e,actionPlaceOrderModal:t})=>{const{assetMode:i}=(0,x.F7)(),n=(0,p.useCallback)((t=>{switch(t){case"size":return(0,s.jsx)(Vt,{sideKey:e});case"notionalSize":return(0,s.jsx)(Rt,{sideKey:e});case"pnl":return(0,s.jsx)(Lt,{sideKey:e});case"tpsl":return(0,s.jsx)(Qt,{sideKey:e});case"entryPrice":return(0,s.jsx)(qt,{sideKey:e});case"markPrice":return(0,s.jsx)(Et,{sideKey:e});case"liquidationPrice":return i?(0,s.jsx)($t,{sideKey:e}):(0,s.jsx)(Ut,{sideKey:e});case"marginRatio":return i?(0,s.jsx)(Ht,{sideKey:e}):(0,s.jsx)(Bt,{sideKey:e});case"margin":return(0,s.jsx)(Wt,{sideKey:e});default:return null}}),[i,e]);return(0,s.jsxs)("div",Object.assign({className:"row-wrap"},{children:[(0,s.jsx)(It,{sideKey:e,actionPlaceOrderModal:t}),Nt.map((e=>(0,s.jsx)(At,{children:n(e)},e)))]}))})),Gt=["pnl","tpsl","size","notionalSize","marginRatio","margin","entryPrice","markPrice","liquidationPrice"],Yt=({sideKey:e})=>{const{getI18n:t}=S(),{formatedPnl:i,pnlColor:n,ROEVal:r}=(0,J.qU)({sideKey:e});return(0,s.jsx)("div",Object.assign({className:"pnl"},{children:(0,s.jsxs)("span",{children:[(0,s.jsx)(zt,{children:t("m-unrealizedPnl",{defaultValue:"Unrealized PNL(ROE %)"})}),(0,s.jsx)(v.Z,Object.assign({variant:"subtitle1",color:n},{children:`${i}(${r})`}))]})}))},Jt=(0,p.memo)((({sideKey:e,actionPlaceOrderModal:t})=>{const{assetMode:i}=(0,x.F7)(),n=(0,p.useCallback)((t=>{switch(t){case"size":return(0,s.jsx)(Vt,{sideKey:e});case"notionalSize":return(0,s.jsx)(Rt,{sideKey:e});case"pnl":return(0,s.jsx)(Yt,{sideKey:e});case"tpsl":return(0,s.jsx)(Qt,{sideKey:e});case"entryPrice":return(0,s.jsx)(qt,{sideKey:e});case"markPrice":return(0,s.jsx)(Et,{sideKey:e});case"liquidationPrice":return i?(0,s.jsx)($t,{sideKey:e}):(0,s.jsx)(Ut,{sideKey:e});case"marginRatio":return i?(0,s.jsx)(Ht,{sideKey:e}):(0,s.jsx)(Bt,{sideKey:e});case"margin":return(0,s.jsx)(Wt,{sideKey:e});default:return null}}),[i,e]);return(0,s.jsxs)("div",Object.assign({className:"row-wrap"},{children:[(0,s.jsx)(It,{sideKey:e,actionPlaceOrderModal:t}),(0,s.jsx)("div",Object.assign({className:"row-grid"},{children:Gt.map((e=>(0,s.jsx)("div",Object.assign({className:e},{children:n(e)}),e)))}))]}))})),Xt={position:"relative",flexDirection:"column",flex:"1 0",".action-bar":{display:"flex",justifyContent:"space-between",alignItems:"center",height:32,pt:10,label:{width:"auto"}},".empty":{display:"flex",minHeight:120,alignItems:"center",justifyContent:"center",color:"t.secondary",fontSize:0},".row-wrap":{fontSize:"12px",color:"t.primary",py:15,borderBottom:"1px solid",borderColor:"line","&:last-of-type":{mb:102,borderBottom:"none"},"& .row-item":{justifyContent:"space-between",alignItems:"center",py:"minor"},"& .symbol-wrap":{display:"flex",alignItems:"center",fontSize:0,"&.buy":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"buy"}},"&.sell":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"sell"}},"& .symbolText":{display:"flex",alignItems:"center",mx:"minor"},"& .symbol":{mr:"minor",fontSize:1,fontWeight:"medium"},"& .leverage":{px:"minor",mr:"6px",fontSize:0,color:"t.yellow",bg:"rgba(240, 185, 11, .15)",borderRadius:"2px"}},"& .close-position":{py:"minor",px:"xs",fontSize:0,color:"t.primary",bg:"line",borderRadius:"3px"}}},ei={position:"relative",flexDirection:"column",height:"100%",".action-bar":{display:"flex",justifyContent:"space-between",alignItems:"center",height:32,pt:0,label:{width:"auto"}},".empty":{display:"flex",minHeight:120,alignItems:"center",justifyContent:"center",color:"t.secondary",fontSize:0},".row-list":{height:"calc(100% - 32px)",overflow:"auto","&::-webkit-scrollbar":{display:"none"},"&::-webkit-scrollbar-thumb":{bg:"transparent"}},".row-wrap":{fontSize:"12px",color:"t.primary",py:"ls",borderBottom:"1px solid",borderColor:"line","&:last-of-type":{mb:15,borderBottom:"none"},".pnl":{display:"flex",alignItems:"center"},".row-grid":{display:"grid",alignItems:"center",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(4, 1fr)",gridGap:"12px 16px",gridTemplateAreas:'"pnl pnl tpsl"\n        "size notionalSize marginRatio"\n        "margin entryPrice markPrice"\n        "liquidationPrice . ."',"& .pnl":{gridArea:"pnl"},"& .tpsl":{gridArea:"tpsl"},"& .tpsl, & .marginRatio, & .markPrice":{textAlign:"right"},"& .right-title":{justifyContent:"flex-end"}},"& .row-item":{justifyContent:"space-between",alignItems:"center"},"& .symbol-wrap":{display:"flex",alignItems:"center",fontSize:0,"&.buy":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"buy"}},"&.sell":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"sell"}},"& .symbolText":{display:"flex",alignItems:"center",mx:"minor"},"& .symbol":{mr:"minor",fontSize:1,fontWeight:"medium"},"& .leverage":{px:"minor",mr:"6px",fontSize:0,color:"t.yellow",bg:"rgba(240, 185, 11, .15)",borderRadius:"2px"}},"& .close-position":{py:"minor",px:"xs",fontSize:0,color:"t.primary",bg:"line",borderRadius:"3px"}}},ti=()=>{const{getI18n:e}=S();return(0,s.jsx)("div",Object.assign({className:"empty"},{children:e("nodata",{defaultValue:"You have no position."})}))},ii=p.memo((({isMobile:e,isEmpty:t,loading:i,data:n=[]})=>{const[a,o]=(0,p.useState)(!1),[l,c]=(0,p.useState)(""),d=(0,p.useMemo)((()=>n.map((e=>({sideKey:e})))),[n]),u=(0,p.useCallback)((()=>{o(!1)}),[]),m=(0,p.useCallback)((e=>{o(!0),c(e)}),[o,c]);return(0,s.jsxs)(r.Z,Object.assign({sx:e?Xt:ei},{children:[(0,s.jsx)(he.Z,{fullScreen:!0,show:i}),(0,s.jsx)(Ne,{}),t?(0,s.jsx)(ti,{}):e?d.map((({sideKey:e})=>(0,s.jsx)(_t,{sideKey:e,actionPlaceOrderModal:m},e))):(0,s.jsx)("div",Object.assign({className:"row-list"},{children:d.map((({sideKey:e})=>(0,s.jsx)(Jt,{sideKey:e,actionPlaceOrderModal:m},e)))})),(0,s.jsx)(dt,{open:a,curSideKey:l,onClose:u})]}))}));var si=i(93400),ni=i(6244);const ri=e=>p.createElement(mt.Z,{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...e},p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.997 12.21a8.161 8.161 0 000-.42v.42zm-4.463 3.327l-2.608-2.608h7.07V20l-2.341-2.342A8.003 8.003 0 014.252 14h3.164a5.001 5.001 0 008.118 1.537zM19.747 10A8.003 8.003 0 006.343 6.343L4.001 4v7.071h7.07L8.466 8.464A5.001 5.001 0 0116.585 10h3.162zM4 12L4 11.845v.31A8.126 8.126 0 014 12z",fill:"currentColor"}));var ai=i(87608),oi=i.n(ai),li=i(96735),ci=i(39478),di=i(6130),ui=i(3101);const mi=p.memo((({type:e})=>"default"===e?(0,s.jsx)(ci.Z,{className:"rank-icon",size:10}):"desc"===e?(0,s.jsx)(di.Z,{className:"rank-icon",size:10}):"asc"===e?(0,s.jsx)(ui.Z,{className:"rank-icon",size:10}):(0,s.jsx)(ci.Z,{className:"rank-icon",size:10})));var pi=i(46787);const hi={fontSize:0,color:"t.secondary",zIndex:9,whiteSpace:"nowrap",".rank-icon":{width:"10px",ml:"2px",transform:"scale(1.6)"}},gi=(0,li.JN)((({style:e,children:t})=>(0,s.jsx)("div",Object.assign({className:"position-row header",style:e},{children:t})))),yi=(0,li.W8)((({value:e,className:t,itemKey:i,rankingType:n,isRankingEnable:r,onRanking:a})=>{const o=(0,p.useCallback)((e=>()=>{let t=b.rV.indexOf(e);t<2?t++:t=0,a({rankingKey:i,rankingType:b.rV[t]})}),[i,a]);return(0,s.jsx)(T.Z,Object.assign({className:t,sx:hi},r&&{onClick:o(n)},{children:e}))})),bi=(0,s.jsx)(pi.Z,{className:"drag-icon",size:12}),xi=(0,li.W6)((e=>{var{showTip:t=!1,tip:i=""}=e,n=(0,f._T)(e,["showTip","tip"]);return t?(0,s.jsx)(q.m,Object.assign({tip:i},n,{children:bi})):bi}));var fi=i(46409),ji=i(76041);const vi={flexDirection:"column",padding:"4px",fontSize:"12px",".radio-title":{my:"10px",color:"t.white",opacity:"0.5"},".radio-row":{display:"flex",alignItems:"center"},svg:{color:"t.yellow"},".unchecked svg":{color:"t.white",cursor:"pointer"},".radio-label":{mr:"24px",fontSize:"12px",color:"t.white",cursor:"pointer"}};function Pi({tipText:e}){const t=(0,h.I0)(),{getI18n:i}=S(),{useLastPrice:n}=(0,ie.F7)(),a=e=>{(0,fi.yN)({pnlPriceBasis:e},{}),t.preference.updateState({useLastPrice:"lastPrice"===e})};return(0,s.jsxs)(r.Z,Object.assign({sx:vi},{children:[e,(0,s.jsx)("div",Object.assign({className:"radio-title"},{children:i("selectPriceBasis",{defaultValue:"Select Price Basis"})})),(0,s.jsx)("div",Object.assign({className:"radio-row"},{children:["markPrice","lastPrice"].map((e=>{const t=n?"lastPrice"===e:"markPrice"===e;return(0,s.jsx)(ji.ZP,Object.assign({className:oi()({unchecked:!t}),value:e,checked:t,onChange:a},{children:(0,s.jsx)("div",Object.assign({className:"radio-label"},{children:i(e)}))}),e)}))}))]}))}const ki={fontSize:0,whiteSpace:"normal",lineHeight:"14px",maxHeight:"28px",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden"},Oi={maxWidth:"330px"},Ci={cursor:"pointer"},Si=p.memo((({headers:e,onSort:t,style:i})=>{const n=(0,h.I0)(),{getI18n:a}=(0,y.yk)(),{showLiqRefresh:o,handleLiqRefresh:l}=St(),c=(0,p.useMemo)((()=>e.filter((({defaultChecked:e,unCheckedComponents:t})=>e||!e&&t))),[e]),d=(0,p.useMemo)((()=>e.filter((({key:e})=>!b.N3.includes(e))).reduce(((e,{key:t})=>(Object.assign(e,{[t]:!1}),e)),{})),[e]),[u,m]=(0,X.Z)(b.Nj,!1),[g,x]=(0,X.Z)(b.nK),[f,j]=(0,X.Z)(b.tC,d),P=(0,h.v9)((e=>e.position.rankingInfo)),{rankingKey:k,rankingType:O}=P,C=(0,p.useCallback)((e=>n.position.updateState({rankingInfo:e})),[n.position]),S=(0,p.useCallback)((e=>{const{rankingKey:t,rankingType:i}=e,s=null==f?void 0:f[t];C(e),x(e),!s&&j(Object.assign(Object.assign(Object.assign({},f),k?{[k]:!1}:{}),{[t]:!0})),"default"===i&&j(Object.assign(Object.assign({},f),{[t]:!1}))}),[k,x,f,j,C]),M=(0,p.useCallback)((e=>{e.stopPropagation()}),[]),T=(0,p.useCallback)((({name:e,tip:t,title:i,learnMoreLink:n,rankingIcon:a,isRankingEnable:c})=>{const d=Object.assign(Object.assign({},ki),c?Ci:{});switch(e){case"pnl":return(0,s.jsxs)(q.m,Object.assign({onTipClick:M,tip:(0,s.jsx)(Pi,{tipText:t}),tipSx:Oi,labelSx:d},{children:[i,a]}));case"closePosition":return(0,s.jsx)(Ke,{tip:t,title:i});case"liquidationPrice":return t?(0,s.jsxs)(q.m,Object.assign({onTipClick:M,tip:t,learnMoreLink:n,labelSx:d},{children:[(0,s.jsxs)(v.Z,{children:[i,a]}),o&&(0,s.jsx)(ri,{ml:"3px",cursor:"pointer",size:12,flexShrink:0,onClick:l})]})):(0,s.jsxs)(r.Z,Object.assign({alignItems:"center"},{children:[(0,s.jsxs)(v.Z,Object.assign({sx:d,color:"t.third"},{children:[i,a]})),o&&(0,s.jsx)(ri,{ml:"3px",cursor:"pointer",size:12,flexShrink:0,onClick:l})]}));default:return t?(0,s.jsxs)(q.m,Object.assign({onTipClick:M,tip:t,learnMoreLink:n,labelSx:d},{children:[i,a]})):(0,s.jsx)(r.Z,Object.assign({alignItems:"center"},{children:(0,s.jsxs)(v.Z,Object.assign({sx:d,color:"t.third"},{children:[i,a]}))}))}}),[l,o]);return(0,p.useEffect)((()=>{g&&C(g)}),[g,C]),(0,s.jsx)(gi,Object.assign({axis:"x",transitionDuration:100,useDragHandle:!0,onSortEnd:({oldIndex:e,newIndex:i})=>{var s;const n=c.map((e=>e.key));if(!(null===(s=c[i])||void 0===s?void 0:s.sortable))return!1;t((0,li.Rp)(n,e,i))},style:i},{children:c.map(((e,t)=>{const{key:i,className:n,title:r,tip:o,sortable:l,learnMoreLink:c,unCheckedComponents:d,defaultChecked:p}=e,h=!p&&d?d.title:r,g=!p&&d?d.tip:o,y=k===i?O:"default",x=!b.N3.includes(i),j=(0,s.jsxs)(s.Fragment,{children:[T({name:i,tip:g,title:h,learnMoreLink:c,isRankingEnable:x,rankingIcon:x?(0,s.jsx)(mi,{type:y}):null}),l&&(0,s.jsx)(xi,{showTip:!u,onMouseLeave:()=>{!u&&m(!0)},tip:a("dragToMove",{defaultValue:"Drag to Move"})})]});return(0,s.jsx)(yi,{index:t,value:j,className:oi()(n,{"header-item":!0,"show-ranking":null==f?void 0:f[i]}),itemKey:i,rankingType:y,isRankingEnable:x,onRanking:S},i)}))}))}));var Mi=i(71245),Ti=i(68350),wi=i(12481),Ki=i(27960);const Ni={padding:"16px",bg:"popupBg",boxShadow:"elevation2",borderRadius:"4px",".check-header":{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px","& .name":{color:"t.secondary",marginRight:"16px"}},".sort-header":{color:"t.third",display:"flex",justifyContent:"flex-start",alignItems:"center","& .back":{marginLeft:"8px",cursor:"pointer",fontSize:"12px"}}},zi=["notionalSize","adl","tpSl","closePosition"],Zi=(0,p.memo)((({headers:e=[],onSort:t,onCheck:i})=>{const n=e.map((e=>Object.assign(Object.assign({},e),{value:e.key,label:e.title}))),r=n.filter((e=>e.sortable&&(e.defaultChecked||e.alwaysShowInColumn))).map((e=>Object.assign(Object.assign({},e),{label:e.sortingTitle||e.title}))),a=n.filter((e=>e.checkable));a.sort(((e,t)=>zi.indexOf(e.value)-zi.indexOf(t.value)));const{getI18n:o}=(0,y.yk)(),[l,c]=(0,p.useState)("check");return"check"===l?(0,s.jsxs)(T.Z,Object.assign({__css:Ni,onClick:e=>e.stopPropagation()},{children:[(0,s.jsxs)("div",Object.assign({className:"check-header"},{children:[(0,s.jsx)(v.Z,Object.assign({variant:"captionSub",className:"name"},{children:o("positions-preferenceTitle")})),(0,s.jsx)("div",Object.assign({className:"action"},{children:(0,s.jsx)(I.Z,Object.assign({variant:"defaultLink",__css:{cursor:"pointer"},onClick:e=>{e.stopPropagation(),c("sort")}},{children:o("positions-preferenceSort")}))}))]})),(0,s.jsx)("div",Object.assign({className:"list"},{children:(0,s.jsx)(Ti.Z,{options:a,getValue:e=>{const s=Object.keys(e)[0],n=e[s];i&&i(a.map((e=>e.value===s?Object.assign(Object.assign({},e),{defaultChecked:n}):e)).filter((e=>e.defaultChecked)).map((e=>e.value)));let o=r.map((e=>e.value));n?o.push(s):o=o.filter((e=>e!==s)),t&&t(o.concat(s))}})}))]})):(0,s.jsxs)(T.Z,Object.assign({__css:Ni,onClick:e=>e.stopPropagation()},{children:[(0,s.jsxs)("div",Object.assign({className:"sort-header"},{children:[(0,s.jsx)(Ki.Z,{size:16,onClick:()=>{c("check")}}),(0,s.jsx)("div",Object.assign({className:"back",onClick:()=>{c("check")}},{children:o("positions-preferenceBack")}))]})),(0,s.jsx)("div",Object.assign({className:"list"},{children:(0,s.jsx)(wi.Z,{items:r,onSort:e=>{t&&t(e)}})}))]}))})),Ai=p.memo((({headers:e,onCheck:t,onSort:i})=>(0,s.jsxs)("div",Object.assign({className:"action-bar"},{children:[(0,s.jsx)(be,{}),(0,s.jsx)(Ee.ZP,Object.assign({trigger:"click",sx:{marginLeft:16,marginTop:"4px"},overlay:(0,s.jsx)(Zi,{headers:e,onCheck:t,onSort:i}),overlayProps:{marginBottom:"8px"},placement:"top",enablePortal:!0},{children:(0,s.jsx)(Mi.Z,{mr:"8px",fontSize:"20px",sx:{color:"icons.close",cursor:"pointer","&:hover path":{fill:"t.third"}}})}))]}))));var Ii=i(4993);const Vi=e=>p.createElement(mt.Z,{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",...e},p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.879 3.293l2.828 2.828-2.12 2.121-2.83-2.828 2.122-2.121zm-3.183 3.182l2.829 2.829-4.667 4.666H10.03v-2.828l4.666-4.667zM7 4h4v3H7v10h10v-4h3v7H4V4h3z",fill:"currentColor"}));var Ri=i(60037);const Li=(0,b.nM)(),qi=({sideKey:e})=>{const{changeSymbol:t}=(0,p.useContext)(W),i=(0,x.t2)(e,"symbol"),{color:n,symbolText:r,symbolName:a,leverage:o}=(0,J.iA)({sideKey:e});return(0,s.jsxs)("div",Object.assign({className:"symbol",onClick:()=>t({symbol:i})},{children:[(0,s.jsx)("div",{className:`bar bar-${n}`}),(0,s.jsx)(Ri.O,{symbolName:a,fallbackText:r}),(0,s.jsx)("div",Object.assign({className:"leverage"},{children:`${o}x`})),(0,s.jsx)(Ii.Z,{size:16,color:"t.yellow",className:"symbolRightArrow"})]}))},Ei=({columnKey:e,sideKey:t})=>{const{color:i,formatedQuantityAmount:n,unit:r}=(0,J.v_)({sideKey:t,columnKey:e});return(0,s.jsx)("div",Object.assign({className:`size size-${i}`},{children:`${n} ${r}`}))},Di=({columnKey:e,sideKey:t})=>{const{formattedNotionalSize:i,unit:n}=(0,J.jK)({sideKey:t,columnKey:e});return(0,s.jsx)("div",Object.assign({className:"notionalSize"},{children:`${i} ${n}`}))},Ui=({sideKey:e})=>{const{formatedEntryPrice:t}=(0,J.A4)({sideKey:e});return(0,s.jsx)("div",Object.assign({className:"entryPrice"},{children:t}))},$i=({sideKey:e})=>{const{formatedMarkPrice:t}=(0,J.z1)({sideKey:e});return(0,s.jsx)("div",Object.assign({className:"markPrice"},{children:t}))},Fi={color:"t.emphasize","&:hover":{color:"t.emphasize"}},Bi=(0,p.memo)((({validLiq:e,formatedLiqPrice:t})=>{const{showLiqRefresh:i,handleLiqRefresh:n}=St(),{getI18n:r}=S(),{getI18n:a}=(0,y.yk)();return(0,s.jsx)("div",Object.assign({className:"liquidationPrice"},{children:i?(0,s.jsx)(q.m,Object.assign({tip:r("liquidationPriceRefreshTip",{defaultValue:""}),labelSx:Fi},{children:(0,s.jsx)("div",Object.assign({className:"liqRefresh",onClick:n},{children:a("refresh",{defaultValue:"Refresh"})}))})):e?t:(0,s.jsx)(q.m,Object.assign({tip:r("liquidationPriceLowRiskTip",{defaultValue:""}),labelSx:Fi},{children:"- -"}))}))})),Hi=({columnKey:e,sideKey:t})=>{const{liquidationPrice:i,formatedLiqPrice:n}=(0,J.Mx)({sideKey:t,columnKey:e}),r=i>0;return(0,s.jsx)(Bi,{validLiq:r,formatedLiqPrice:n})},Wi=({columnKey:e,sideKey:t})=>{const{liquidationPrice:i,formatedLiqPrice:n}=wt({sideKey:t,columnKey:e}),r=i>0;return(0,s.jsx)(Bi,{validLiq:r,formatedLiqPrice:n})},Qi=({ratioColor:e,riskRatio:t})=>(0,s.jsxs)("div",Object.assign({className:`marginRatio marginRatio-${e}`},{children:[t,"%"]})),_i=({columnKey:e,sideKey:t})=>{const{ratioColor:i,riskRatio:n}=(0,J.ek)({sideKey:t,columnKey:e});return(0,s.jsx)(Qi,{ratioColor:i,riskRatio:n})},Gi=({columnKey:e,sideKey:t})=>{const{ratioColor:i,riskRatio:n}=Kt({sideKey:t,columnKey:e});return(0,s.jsx)(Qi,{ratioColor:i,riskRatio:n})},Yi=({columnKey:e,sideKey:t})=>{const[i,n]=(0,p.useState)(!1),{assetMode:r}=(0,x.F7)(),{actionAdjustMarginModal:a}=(0,p.useContext)(W),o=(0,x.t2)(t,"positionSize"),l=(0,x.t2)(t,"isolated"),c=(0,x.t2)(t,"isolatedWallet"),{getI18n:d}=S(),u=l?d("headerIsolated",{defaultValue:"Isolated"}):d("header-Cross",{defaultValue:"Cross"}),{formatedMargin:m}=(0,J.Yq)({sideKey:t,columnKey:e}),h=(0,p.useCallback)((()=>{l&&(0===Number(o)&&c<0?te.ee.emit("SHOW_NEG_BALANCE_CLEAR_MODAL",{isJoinMargin:r,isolated:l,isCM:Li}):a(t))}),[a,r,l,c,o,t]),g=(0,p.useMemo)((()=>(0,s.jsx)(Vi,{size:16,color:i?"t.primary":"t.third"})),[i]);return(0,s.jsx)(s.Fragment,{children:l?(0,s.jsxs)("div",Object.assign({className:"margin",style:{minWidth:"auto",cursor:"pointer"},onClick:h,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},{children:[(0,s.jsxs)("div",Object.assign({className:"margin-text"},{children:[(0,s.jsx)("div",{children:m}),(0,s.jsx)("div",{children:`(${u})`})]})),(0,s.jsxs)("div",Object.assign({className:"margin-icon-container"},{children:[g,c<0&&(0,s.jsx)("div",{className:"red-point"})]}))]})):(0,s.jsx)("div",Object.assign({className:"margin"},{children:(0,s.jsxs)("div",Object.assign({className:"margin-text"},{children:[(0,s.jsx)("div",{children:m}),(0,s.jsx)("div",{children:`(${u})`})]}))}))})},Ji=({columnKey:e,sideKey:t})=>{const{formatedPnl:i,pnlColor:n,ROEVal:r}=(0,J.qU)({sideKey:t,columnKey:e});return(0,s.jsxs)("div",Object.assign({className:`pnl pnl-${n}`},{children:[(0,s.jsxs)("span",{children:[(0,s.jsx)("div",{children:i}),(0,s.jsx)("div",{children:`(${r})`})]}),(0,s.jsx)(vt,{sideKey:t})]}))},Xi=({sideKey:e})=>{const t=(0,x.t2)(e,"adl");return(0,s.jsx)("div",Object.assign({className:"adl"},{children:(0,s.jsx)(Ot,{adl:t})}))},es=({sideKey:e})=>{const t=(0,x.t2)(e,"positionSize");return(0,s.jsx)("div",Object.assign({className:"closePosition"},{children:t?(0,s.jsx)(ot,{sideKey:e}):(0,s.jsx)(s.Fragment,{})}))},ts=({columnKey:e,sideKey:t})=>{const{actionTpslModal:i}=(0,p.useContext)(W),{formatedTPPrice:n,formatedSLPrice:r}=(0,J.Mn)({sideKey:t,columnKey:e}),a=(0,p.useMemo)((()=>(0,s.jsx)(Vi,{size:16,sx:{cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},onClick:()=>i(t)})),[t,i]);return(0,s.jsxs)("div",Object.assign({className:"tpSl"},{children:[(0,s.jsxs)("div",Object.assign({className:"tpSl-text"},{children:[(0,s.jsxs)("div",{children:[n," /"]}),(0,s.jsx)("div",{children:r})]})),a]}))},is=(0,p.memo)((({sideKey:e})=>{const{assetMode:t}=(0,x.F7)(),{headers:i}=(0,p.useContext)(W),n=(0,p.useCallback)((({key:i})=>{switch(i){case"symbol":return(0,s.jsx)(qi,{sideKey:e,columnKey:i},i);case"size":return(0,s.jsx)(Ei,{sideKey:e,columnKey:i},i);case"notionalSize":return(0,s.jsx)(Di,{sideKey:e,columnKey:i},i);case"entryPrice":return(0,s.jsx)(Ui,{sideKey:e,columnKey:i},i);case"markPrice":return(0,s.jsx)($i,{sideKey:e,columnKey:i},i);case"liquidationPrice":return t?(0,s.jsx)(Wi,{sideKey:e,columnKey:i},i):(0,s.jsx)(Hi,{sideKey:e,columnKey:i},i);case"marginRatio":return t?(0,s.jsx)(Gi,{sideKey:e,columnKey:i},i):(0,s.jsx)(_i,{sideKey:e,columnKey:i},i);case"margin":return(0,s.jsx)(Yi,{sideKey:e,columnKey:i},i);case"pnl":return(0,s.jsx)(Ji,{sideKey:e,columnKey:i},i);case"adl":return(0,s.jsx)(Xi,{sideKey:e,columnKey:i},i);case"closePosition":return(0,s.jsx)(es,{sideKey:e,columnKey:i},i);case"tpSl":return(0,s.jsx)(ts,{sideKey:e,columnKey:i},i);default:return(0,s.jsx)("div",{})}}),[t,e]);return(0,s.jsx)("div",Object.assign({className:"position-row body"},{children:i.filter((e=>e.defaultChecked||e.alwaysShowInColumn)).map(n)}))})),ss=e=>(0,s.jsx)(is,Object.assign({},e)),ns=(e,t)=>t[e].sideKey,rs=p.memo((({loading:e,headers:t,onCheckHeader:i,onSortHeader:n,data:a=[]})=>{const o=(()=>{const e=(0,x.AM)(),t=(0,h.v9)((e=>e.position.positionMap)),i=(0,re.ZP)(re.ME),{rankingKey:s,rankingType:n}=(0,h.v9)((e=>e.position.rankingInfo)),r=(0,p.useCallback)(((e,s,n=!1)=>{var r;return null===(r=ue(e,n?i:t))||void 0===r?void 0:r[s]}),[i,t]),a=(0,p.useCallback)((i=>{const{symbol:s=""}=ue(i,t)||{},n=null==e?void 0:e[s],{pair:r="",baseAsset:a="",quoteAsset:o=""}=n,l=(0,f._T)(n,["pair","baseAsset","quoteAsset"]);return Object.assign({symbolName:r||`${a}${o}`},l)}),[t,e]);return(0,p.useMemo)((()=>{const e=[],t=de.includes(s);return("entryPrice"===s||"markPrice"===s||t)&&("asc"===n?e.push(((e,i)=>ce(r(e,s,t),r(i,s,t)))):"desc"===n&&e.push(((e,i)=>le(r(e,s,t),r(i,s,t))))),"symbol"===s&&"default"!==n&&("asc"===n?e.push(((e,t)=>oe(a(e).symbolName,a(t).symbolName))):"desc"===n&&e.push(((e,t)=>ae(a(e).symbolName,a(t).symbolName))),e.push(((e,t)=>{const{symbolName:i,contractType:s}=a(e),{symbolName:n,contractType:r}=a(t);return i!==n?0:le((0,ne.vgT)(s,b.IR),(0,ne.vgT)(r,b.IR))})),e.push(((e,t)=>le((0,ne.vgT)("positionSide",r(e,s)),(0,ne.vgT)("positionSide",r(t,s)))))),(0,ne.HCG)(e)}),[s,n,r,a])})(),l=(0,p.useMemo)((()=>o(a).map((e=>({sideKey:e})))),[a,o]),c=(0,p.useMemo)((()=>{let e=0;return t.filter((e=>e.defaultChecked||!e.defaultChecked&&e.unCheckedComponents)).forEach((({key:t})=>{e+=_e[t]||0})),{minWidth:e}}),[t]),{getI18n:d}=(0,y.yk)(),{apiError:u,onRefresh:m}=(()=>{const[e]=(0,x.z4)(),t=(0,h.v9)((e=>e.loading.effects.position.queryPosition)),i=(0,h.v9)((e=>e.position.apiError)),s=(0,h.I0)(),n=(0,p.useCallback)((()=>{t||s.position.queryPosition({symbol:e})}),[t,s.position]);return(0,p.useMemo)((()=>({loading:t,apiError:i,onRefresh:n})),[t,i,n])})(),g=Me({hideOtherSymbol:!1});return(0,s.jsx)("div",Object.assign({id:"position-pc",style:{height:"100%"}},{children:(0,s.jsxs)(r.Z,Object.assign({sx:Ye},{children:[(0,s.jsx)(Ai,{headers:t,onSort:n,onCheck:i}),(0,s.jsx)(Si,{headers:t,onSort:n,style:c}),(0,s.jsx)(ni.v,Object.assign({apiError:u,confirmTip:d("positionErrorConfirmTip",{defaultValue:"Cancel all open orders and close all positions here."}),onRefresh:m,onConfirm:g},{children:(0,s.jsx)(si.a,{direction:"xxx",dataSource:l,loading:e,loadWithContent:!0,listSx:c,itemElement:ss,itemKey:ns,itemHeight:40})}))]}))}))}));var as=i(29787),os=i.n(as),ls=i(34708),cs=i(30757);const ds=p.memo((e=>{var{label:t,tip:i,value:n,hasTip:a=!0}=e,o=(0,f._T)(e,["label","tip","value","hasTip"]);return(0,s.jsxs)(r.Z,Object.assign({className:"rules"},o,{children:[a?(0,s.jsx)(q.m,Object.assign({tip:i},{children:t})):(0,s.jsx)(v.Z,Object.assign({className:"label"},{children:t})),n]}))})),us={position:"relative",px:"24px",width:["100%","488px"],height:["100%","unset"],bg:"modalBg",borderRadius:"6px",boxShadow:"elevation3",".title":{py:"20px",color:"t.primary"},".content":{pt:"14px",pb:"30px"},".rules":{alignItems:"center",justifyContent:"space-between",fontSize:1,pb:"ls",color:"t.primary"},".label":{color:"t.third"},".viewMore":{fontSize:1,px:"2px",py:"4px"}};let ms;const ps="%",hs=(p.memo((()=>{const e=(0,x.tZ)(),{getI18n:t}=(0,y.yk)(),i=(0,x.gm)(),n=(0,b.nM)(),{shortName:r}=(0,x.oO)(),{baseAsset:a,quoteAsset:o,filters:l=[],liquidationFee:c=0,contractVal:d=0,triggerProtect:u=0,maxMoveOrderLimit:m=0}=(0,x.j2)()||{},h=(0,cs.FB)(l,"filterType"),g=((e,t,i,s)=>{const n=[{labelKey:"minimumTradeAmount",defaultLabel:"Minimum Trade Amount",filterType:"LOT_SIZE",field:"minQty",tipKey:"minimumTradeAmountTip",defaultTip:"The minimum Limit Order amount for the contract.",unit:e},{labelKey:"minPriceMovement",defaultLabel:"Min Price Movement",filterType:"PRICE_FILTER",field:"tickSize",tipKey:"minPriceMovementTip",defaultTip:"The minimum change in the unit price of the contract.",unit:t},{labelKey:"orderPriceCapRatio",defaultLabel:"Order Price Cap Ratio",filterType:"PERCENT_PRICE",field:"multiplierUp",tipKey:"orderPriceCapRatioTip",defaultTip:"The upper limit ratio of the order price to current Mark Price of the contract.",unit:i,shouldFormat:!0},{labelKey:"orderPriceFloorRatio",defaultLabel:"Order Price Floor Ratio",filterType:"PERCENT_PRICE",field:"multiplierDown",tipKey:"orderPriceFloorRatioTip",defaultTip:"The lower limit ratio of the order price to current Mark Price of the contract.",unit:i,shouldFormat:!0},{labelKey:"maximumMarketOrderAmount",defaultLabel:"Maximum Market Order Amount",filterType:"MARKET_LOT_SIZE",field:"maxQty",tipKey:"maximumMarketOrderAmountTip",defaultTip:"The minimum Market Order amount for the contract.",unit:e},{labelKey:"maximumOpenOrderAmount",defaultLabel:"Maximum Open Order Amount",filterType:"MAX_NUM_ORDERS",field:"limit",tipKey:"maximumOpenOrderAmountTip",defaultTip:"The maxium Open Orders for the contract."}];return s||n.push({labelKey:"minNotional",defaultLabel:"Min. Notional Value",filterType:"MIN_NOTIONAL",field:"notional",tipKey:"minNotionalTip",defaultTip:"The minimum notional value for the contract order.",unit:t}),n})(n?t("Cont",{defaultValue:"Cont"}):a,o,ps,n),[f,O]=(0,p.useState)(!1),C=(0,p.useCallback)((()=>{O(!1),"function"==typeof ms&&ms()}),[]);return(0,p.useEffect)((()=>ls.Y.on(b.Dg,(({visible:e,afterClose:t})=>{O(e),ms=t}))),[]),(0,s.jsxs)(j.Z,Object.assign({visible:f,sx:us},{children:[(0,s.jsx)(v.Z,Object.assign({variant:"headline6",className:"title"},{children:t("trading-rules",{defaultValue:"Trading Rules"})})),(0,s.jsx)(k.Z,{sx:{position:"absolute",top:"22px",right:"24px",cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},onClick:C}),(0,s.jsxs)(T.Z,Object.assign({className:"content"},{children:[(0,s.jsx)(ds,{hasTip:!1,label:t("symbol",{defaultValue:"Symbol"}),value:r}),g.map((({labelKey:e,defaultLabel:n,filterType:r,field:a,tipKey:o,defaultTip:l,unit:c="",shouldFormat:d=!1})=>{var u;let m=null===(u=null==h?void 0:h[r])||void 0===u?void 0:u[a];m=c===ps?100*("multiplierUp"===a?m-1:1-m):m;const p=d?(0,Ie.uf)(m,0):m,g="rtl"===i?`${c} ${p}`:`${p} ${c}`;return(0,s.jsx)(ds,{label:t(e,{defaultValue:n}),tip:t(o,{defaultValue:l}),value:g},e)})),n&&(0,s.jsx)(ds,{label:t("contractSize",{defaultValue:"Contract Multiplier"}),tip:t("contractSizeTip"),value:`${d} ${o}`}),(0,s.jsx)(ds,{label:t("triggerProtect",{defaultValue:"Price Protection Rate"}),tip:t("triggerProtectTip"),value:`${100*+u} ${ps}`}),(0,s.jsx)(ds,{label:t("liquidationFee",{defaultValue:"Insurance Clearance Fee"}),tip:t("liquidationFeeTip"),value:`${(100*+c).toFixed(2)} ${ps}`}),n&&(0,s.jsx)(ds,{label:t("maxAmendAmount",{defaultValue:"Max Amend Amount"}),tip:t("maxAmendAmountTip"),value:(0,Ie.uf)(m,0)}),(0,s.jsx)(P.Z,Object.assign({as:"a",variant:"text",href:`/${e}/futures/trading-rules/${n?"quarterly":"perpetual"}`,target:"_blank",className:"viewMore"},{children:t("viewMore",{defaultValue:"View More"})}))]}))]}))})),p.memo((({label:e,children:t})=>(0,s.jsxs)(r.Z,Object.assign({sx:{justifyContent:"space-between",fontSize:"14px",lineHeight:"16px",height:"24px",alignItems:"center"}},{children:[(0,s.jsx)(v.Z,Object.assign({color:"t.third"},{children:e})),(0,s.jsx)(r.Z,{children:t})]}))))),gs=p.memo((({sideKey:e,quoteAsset:t})=>{const{getI18n:i}=S(),{formatedEntryPrice:n}=(0,J.A4)({sideKey:e});return(0,s.jsx)(hs,Object.assign({label:i("entryPrice",{defaultValue:"Entry Price"})},{children:(0,s.jsxs)(v.Z,Object.assign({sx:{color:"t.primary"}},{children:[n," ",t]}))}))})),ys=p.memo((({sideKey:e,quoteAsset:t})=>{const{getI18n:i}=S(),{formatedMarkPrice:n}=(0,J.z1)({sideKey:e});return(0,s.jsx)(hs,Object.assign({label:i("markPrice",{defaultValue:"Mark Price"})},{children:(0,s.jsxs)(v.Z,Object.assign({sx:{color:"t.primary"}},{children:[n," ",t]}))}))}));var bs=i(62493),xs=i(29002);const fs=p.memo((({i18nType:e,stopIndex:t})=>{const{getI18n:i}=(0,y.yk)();return(0,s.jsxs)(r.Z,Object.assign({alignItems:"center",color:"t.third",pl:"8px"},{children:[e,"QUOTE"!==t&&(0,s.jsx)(q.m,Object.assign({tip:i("roe-stop-tip")},{children:(0,s.jsx)(bs.Z,{size:16,ml:"4px"})}))]}))})),js=p.memo((({sideKey:e,order:t,type:i,cancelOrder:n,price:a,changePrice:o,workingType:l,changeWorkingType:c})=>{var d;const{getI18n:u}=S(),{getI18n:m}=(0,y.yk)(),h=(0,x.ce)(),g=(0,x.t2)(e,"symbol"),b=Number((0,x.t2)(e,"positionSize")),f=(0,x.NJ)(g),j=b>0?1:-1,P=(0,x.t2)(e,"entryPrice"),k=(null===(d=(0,x.AM)())||void 0===d?void 0:d[g])||{},{quoteAsset:O,marginAsset:C="",tickSize:w,pricePrecision:K,contractVal:Z=100}=k,A=t?t.workingType:l,I=t?t.stopPrice:a,{isDelivery:V}=(0,p.useContext)(W),q=(0,$e.p)(w),E=w,D=(0,R.uf)(I,K),U=u("CONTRACT_PRICE"===A?"lastPrice":"markPrice"),$=(0,s.jsx)(L.c,{i18nKey:M("takeProfitNodeTip"),defaults:"When <text>{{workingType}}</text> reaches <text>{{stopPrice}}</text>, it will trigger Take Profit Market order to close this position. Estimated PNL will be",values:{workingType:U,stopPrice:D},components:{text:(0,s.jsx)(v.Z,{as:"span",color:"t.primary"})}}),F=(0,s.jsx)(L.c,{i18nKey:M("stopLossNodeTip"),defaults:"When <text>{{workingType}}</text> reaches <text>{{stopPrice}}</text>, it will trigger Stop Market order to close this position. Estimated PNL will be",values:{workingType:U,stopPrice:D},components:{text:(0,s.jsx)(v.Z,{as:"span",color:"t.primary"})}}),B=u("takeProfit"===i?"takeProfit":"stopLoss"),H="takeProfit"===i?$:F,Q=t&&(b>0&&"TAKE_PROFIT_MARKET"===t.type||b<0&&"STOP_MARKET"===t.type)?">=":"<=";let _="——",G="takeProfit"===i?"buy":"sell",Y="";if(""!==I){const e=(({stopPrice:e,entryPrice:t,positionSize:i,contractVal:s,isDelivery:n})=>n?i*s*(1/t-1/e):i*(e-t))({stopPrice:Number(I),entryPrice:P,positionSize:b,contractVal:Z,isDelivery:V});Number.isFinite(e)&&(_=(0,R.uf)(e,h)),G=e>0?"buy":"sell",Y=e>0?"buy":e<0?"sell":""}const[J,X]=(0,p.useState)("QUOTE"),[ee,te]=(0,p.useState)(""),ie=((0,p.useCallback)((e=>{X(e),te(""),o("")}),[]),"QUOTE"===J?a:ee),se=(0,p.useCallback)((e=>/[^\d|.|,|\u3002|e]/.test(e.key)&&e.preventDefault()),[]),ne=(0,p.useCallback)((e=>{if("QUOTE"===J)(0,z._p)(e,o,"",q);else{const t=(0,R.GW)(Math.abs(e.target.value),2),s="takeProfit"===i?Number(t):-Number(t),n=(({roe:e,entryPrice:t,side:i,leverage:s,isDelivery:n})=>n?t*e/100/(i*s)+t:t*i*s/(i*s-e/100))({roe:s,entryPrice:P,side:j,leverage:f,isDelivery:V});te(s?String(s):""),o(n.toFixed(q))}}),[J,o,q,i,P,j,f,V]),re=(0,p.useCallback)((()=>!!t&&n(t,i)),[n,t,i]),ae="ROE"===J&&(({type:e,side:t,roe:i,leverage:s,isDelivery:n})=>!n&&"takeProfit"===e&&1===t&&i/100>=s||!n&&"takeProfit"!==e&&-1===t&&i/100<=-s||!!(n&&"takeProfit"===e&&-1===t&&i/100>=s)||!!(n&&"takeProfit"!==e&&1===t&&i/100<=-s))({type:i,side:j,roe:Number(ee),leverage:f,isDelivery:V}),oe="takeProfit"===i?m("less-than-reo",{defaultValue:"The ROE% must be less than {{leveragedRoe}}%",leveragedRoe:100*f}):m("greater-than-reo",{defaultValue:"The ROE% must be greater than {{leveragedRoe}}%",leveragedRoe:-100*f});return(0,s.jsxs)(T.Z,Object.assign({py:"16px"},{children:[os()(t)?(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(N.Z,{type:"number",step:"QUOTE"===J?E:.01,variant:"filled",textAlign:"right",prefix:(0,s.jsx)(fs,{i18nType:B,stopIndex:J}),placeholder:Number(0).toFixed(K),suffix:O,value:ie,error:ae,onKeyPress:se,onChange:ne,size:"md",boxProps:{sx:{flex:"auto",input:{pr:0}}}}),(0,s.jsx)(xs.Z,{workingType:l,changeWorkingType:c})]}):(0,s.jsx)(hs,Object.assign({label:B},{children:(0,s.jsxs)(r.Z,Object.assign({justifyContent:"end"},{children:[(0,s.jsx)(v.Z,Object.assign({color:"t.primary"},{children:`${U} ${Q} ${D} ${O}`})),(0,s.jsx)(v.Z,Object.assign({sx:{ml:"sm",cursor:"pointer",color:"t.yellow200","&:hover":{color:"t.yellow300"}},onClick:re},{children:u("cancel")}))]}))})),ae?(0,s.jsx)(T.Z,Object.assign({sx:{mt:"xs",color:"sell",minHeight:"40px"}},{children:oe})):(0,s.jsxs)(T.Z,Object.assign({sx:{mt:"xs",width:"100%",fontSize:"12px",lineHeight:"20px",color:"t.third"}},{children:[H,(0,s.jsxs)(v.Z,Object.assign({as:"span",color:Y},{children:[" ",_," ",C]}))]}))]}))})),vs=p.memo((({sideKey:e})=>{const{getI18n:t}=S(),{symbolText:i,leverage:n}=(0,J.iA)({sideKey:e}),r=(0,x.t2)(e,"positionSize"),a=(0,x.t2)(e,"positionSide"),o=r>0?"buy":"sell";let l="";return"LONG"===a?l=t("psLong",{defaultValue:"Long"}):"SHORT"===a&&(l=t("psShort",{defaultValue:"Short"})),(0,s.jsx)(hs,Object.assign({label:t("symbol",{defaultValue:"Symbol"})},{children:(0,s.jsxs)(v.Z,Object.assign({color:o},{children:[i," ",l," ",n,"x"]}))}))})),Ps="MARK_PRICE",ks={position:"relative",padding:"20px 24px 24px 24px",width:["100%","464px"],height:["100%","auto"],maxHeight:["100%","600px"],bg:"modalBg",boxShadow:"elevation3",borderRadius:"8px",".title":{fontSize:["16px","20px"],pb:"16px",color:"t.primary"},".info-block":{mt:"8px",".tpsl-max-qty-tip":{color:"t.primary",lineHeight:"20px",fontSize:"14px",".learn-more":{cursor:"pointer"}},".line":{height:"1px",bg:"line"}},".tpsl-tip":{color:"t.secondary",mt:"xs",fontSize:"12px"},".footer":{mt:"24px",display:"flex",position:["absolute","static"],bottom:["24px",null],width:["calc(100% - 48px)","100%"]}},Os=p.memo((({visible:e,position:t,onClose:i})=>{var r;const{sideKey:l=""}=t,c=(0,x.t2)(l,"symbol"),u=(0,x.t2)(l,"positionSize"),m=(0,x.t2)(l,"positionSide"),h=(0,x.AM)()[c]||{},{quoteAsset:g,filters:O=[]}=h,C=null===(r=O.find(it.vr))||void 0===r?void 0:r.maxQty,{strategyOrders:M}=(0,J.Mn)({sideKey:l}),[T,w]=(0,p.useState)(M.tp),[K,N]=(0,p.useState)(M.sl),[z,Z]=(0,p.useState)(""),[A,I]=(0,p.useState)(Ps),[V,R]=(0,p.useState)(""),[L,q]=(0,p.useState)(Ps);(0,p.useEffect)((()=>{e&&(w(M.tp),N(M.sl),Z(""),I(Ps),R(""),q(Ps))}),[e]);const{getI18n:E,i18n:{language:D}}=S(),{getI18n:U}=(0,y.yk)(),{enqueueNotification:$}=(0,a.Z)(),{delOpenOrders:F}=d(),B=(0,p.useCallback)(((e,t)=>(0,f.mG)(void 0,void 0,void 0,(function*(){const{success:i,data:s,message:n}=yield F(e);i&&(null==s?void 0:s.orderId)&&("takeProfit"===t&&w(void 0),"stopLoss"===t&&N(void 0)),i&&$({message:n||"success",variant:"success"})}))),[F,$]),H=(0,p.useCallback)(((e,t)=>(0,f.mG)(void 0,void 0,void 0,(function*(){const i={symbol:c,side:u>0?"SELL":"BUY",positionSide:m,type:t,timeInForce:"GTE_GTC",quantity:0,stopPrice:e.stopPrice,workingType:e.workingType,closePosition:!0,placeType:"position"},{success:s,message:r,data:a}=(Date.now(),yield(0,n.cG)((0,o.$)(i),{language:D}));s&&$({message:r||"success",variant:"success"})}))),[!1,c,D,u,m,$]),W=(0,p.useCallback)((()=>{(()=>{const e=os()(T)&&z&&A,t=os()(K)&&V&&L,s=[];e&&s.push(H({stopPrice:z,workingType:A},"TAKE_PROFIT_MARKET")),t&&s.push(H({stopPrice:V,workingType:L},"STOP_MARKET")),Promise.all(s).finally(i)})()}),[i,H,K,V,L,T,z,A]);return(0,s.jsxs)(j.Z,Object.assign({visible:!!l&&e,sx:ks,onMaskClick:()=>i()},{children:[(0,s.jsx)(v.Z,Object.assign({variant:"headline6",className:"title"},{children:E("tpSl",{defaultValue:"TP/SL for entire position"})})),(0,s.jsx)(k.Z,{sx:{position:"absolute",top:"22px",right:"24px",cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},onClick:i}),(0,s.jsxs)("div",Object.assign({className:"info-block"},{children:[Math.abs(u)>Number(C)?(0,s.jsxs)("div",Object.assign({className:"tpsl-max-qty-tip"},{children:[U("tpslMaxQty-tip",{defaultValue:"Due to the position size exceeds the maximum limit of market order, the Position Take-profit and Stop-loss will not be executed. Please use Limit order or TP/SL limit order."}),(0,s.jsx)(v.Z,Object.assign({variant:"addressLink",color:"t.yellow",mt:"5px",className:"learn-more",onClick:()=>(({afterClose:e}={})=>{ls.Y.emit(b.Dg,{visible:!0,afterClose:e})})()},{children:U("tpslMaxQty-learnMore",{defaultValue:"Learn more trading rules"})}))]})):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(vs,{sideKey:l}),(0,s.jsx)(gs,{sideKey:l,quoteAsset:g}),(0,s.jsx)(ys,{sideKey:l,quoteAsset:g})]}),(0,s.jsx)(js,{sideKey:l,order:T,cancelOrder:B,type:"takeProfit",price:z,changePrice:Z,workingType:A,changeWorkingType:I}),(0,s.jsx)("div",{className:"line"}),(0,s.jsx)(js,{sideKey:l,order:K,cancelOrder:B,type:"stopLoss",price:V,changePrice:R,workingType:L,changeWorkingType:q})]})),(0,s.jsxs)("div",Object.assign({className:"tpsl-tip"},{children:["· ",E("tpSlTip")]})),(0,s.jsx)("div",Object.assign({className:"footer"},{children:(0,s.jsx)(P.Z,Object.assign({flex:"auto",onClick:W,height:"40px"},{children:E("confirm",{defaultValue:"Confirm"})}))}))]}))})),Cs=(0,b.nM)(),Ss=p.memo((()=>{const e=(0,h.v9)((e=>e.loading.effects.position.queryPosition)),{i18n:t}=S(),{getI18n:i}=(0,y.yk)(),[l,{onCheckHeader:c,onSortHeader:u}]=(({getFutI18n:e})=>{const{useLastPrice:t}=(0,ie.F7)(),{i18n:{language:i}}=(0,y.ZK)(),n=t?"lastPrice":"markPrice",[r,a]=(0,X.Z)(b.Zt,["closePosition","tpSl"]),[o,l]=(0,X.Z)(b.o5,["symbol","size","entryPrice","markPrice","liquidationPrice","marginRatio","margin","pnl","closePosition","tpSl"]),c=(0,b.nM)();return[(0,p.useMemo)((()=>{const t=[{key:"symbol",className:"symbol",title:e("symbol",{defaultValue:"Symbol"}),checkable:!1,sortable:!1},{key:"size",className:"size",title:e("size",{defaultValue:"Size"}),tip:c?e("cSizeDes",{defaultValue:"Trading units using coins in COIN-M Futures such as BTC, open position amounts shown are calculated based on the actual cont quantity. Values change with the last price of the symbol."}):e("uSizeDes",{defaultValue:"Trading units using stable coins in USDⓈ-M Futures such as USDT, open position amounts shown are calculated based on the actual coin quantity. Values change with the last price of the symbol."}),checkable:!1,sortable:!0},{key:"notionalSize",className:"notionalSize",title:e("notionalSize",{defaultValue:"Notional Size"}),checkable:!0,sortable:!0},{key:"entryPrice",className:"entryPrice",title:e("entryPrice",{defaultValue:"Entry Price"}),tip:e("entryPriceTip",{defaultValue:"Average executed buy/sell price for your current long/short position."}),checkable:!1,sortable:!0},{key:"markPrice",className:"markPrice",title:e("markPrice",{defaultValue:"Mark Price"}),tip:(0,s.jsx)(se,{getFutI18n:e}),checkable:!1,sortable:!0},{key:"liquidationPrice",className:"liquidationPrice",title:e("liquidationPrice",{defaultValue:"Liq.Price"}),tip:e("liquidationPriceTip",{defaultValue:"If the mark price of the contract reaches below this price (when long) or above this price(when short), your position will be liquidated."}),learnMoreLink:(0,te.CN)(b.Wh.LIQ_PRICE,{locale:(0,ee.sU)(i)}),checkable:!1,sortable:!0},{key:"marginRatio",className:"marginRatio",title:e("marginRatio",{defaultValue:"Margin Ratio"}),tip:e("marginRatioTip",{defaultValue:"The lower the Margin Ratio, the lower your liquidation level will be relative to your position size. Your positions will be liquidated once Margin Ratio reaches 100%."}),checkable:!1,sortable:!0},{key:"margin",className:"margin",title:e("margin",{defaultValue:"Margin"}),tip:e("marginTip",{defaultValue:"The margin allocated to the current position."}),checkable:!1,sortable:!0},{key:"pnl",className:"pnl",title:e("unrealizedPnl",{defaultValue:"PNL(ROE %)"}),tip:e(`unrealizedPnlTip-${n}`),checkable:!1,sortable:!0},{key:"adl",className:"adl",title:e("adl",{defaultValue:"ADL"}),tip:e("adlTip",{defaultValue:"This indicator shows your position in the auto-deleverage queue. If all lights are lit, in the event of a liquidation, your position may be reduced."}),checkable:!0,sortable:!0},{key:"closePosition",className:"closePosition",title:e("closePosition",{defaultValue:"Close All Position"}),tip:e("closePositionTip",{defaultValue:"Closing all positions cancels all open orders under {{futuresType}} and close all positions under {{futuresType}} by market order.",futuresType:c?"COIN-M":"USDⓈ-M"}),alwaysShowInColumn:!0,unCheckedComponents:{title:e("positions-action",{defaultValue:"Action"}),tip:null},sortingTitle:e("positions-preferenceAction",{defaultValue:"Action (Market/Limit)"}),checkable:!0,sortable:!0},{key:"tpSl",className:"tpSl",title:e("tpSlV2",{defaultValue:"TP/SL for position"}),tip:e("tpSlTip"),checkable:!0,sortable:!0}].map((e=>Object.assign(Object.assign({},e),{defaultChecked:!e.checkable||(null==r?void 0:r.includes(e.key))||!1})));return t.sort(((e,t)=>o?o.indexOf(e.key)-o.indexOf(t.key):0)),t}),[e,c,i,n,r,o]),{onCheckHeader:a,onSortHeader:l}]})({getFutI18n:i}),{preOrders:f=[]}=(0,x.E)(),{delOpenOrders:j}=d(),v=(0,x.Dj)(),{enqueueNotification:P}=(0,a.Z)(),[k,O]=(0,p.useState)(""),[C,M]=(0,p.useState)({}),{curLeverage:T}=(0,x.rf)(),{language:w="en"}=t,K=(0,x.d0)(),N=!e&&0===v.length,z=(0,p.useCallback)((()=>{O(""),M({})}),[O,M]),Z=(0,p.useCallback)((e=>{O("ADJUST_MARGIN"),M({sideKey:e})}),[O,M]),A=(0,p.useCallback)((e=>{O("TP_SL"),M({sideKey:e})}),[O,M]),I=(0,p.useCallback)(((e,t,i)=>{O("ORDER_CONFIRM"),M({sideKey:e,closeParams:t,onConfirm:i})}),[O,M]),V=(0,p.useCallback)((e=>{const{price:t,positionSide:s,type:r}=e,a="MARKET"===r;if(!a&&!t)return Promise.resolve();const l={leverage:T,timeInForce:b.rb.GTC,reduceOnly:!0};let c=Object.assign(Object.assign({},e),l);return m()(c,"buyQty","sellQty"),a&&(c.newOrderRespType="RESULT",c=m()(c,"price","timeInForce")),"LONG"!==s&&"SHORT"!==s||(c=m()(c,"reduceOnly")),(0,n.cG)((0,o.$)(Object.assign(Object.assign({},c),{placeType:"position"})),{language:w}).then((e=>{const{success:t,message:s,data:n}=e||{};return t&&!s&&P({message:i("order-submitted",{defaultValue:""}),variant:"success"}),Promise.resolve(n)})).catch((()=>{}))}),[T,w,P,i]),R=(0,p.useCallback)((e=>{const t=f.filter((t=>(null==t?void 0:t.orderId)===e));return 1===t.length?j(t[0]):Promise.resolve()}),[j,f]),L=(0,p.useMemo)((()=>({actionAdjustMarginModal:Z,actionTpslModal:A,actionOrderConfirmModal:I,actionCancelOrder:R,actionPlaceOrder:V,changeSymbol:K,isDelivery:Cs,headers:l})),[Z,A,I,R,V,K,l]);return(0,s.jsx)(W.Provider,Object.assign({value:L},{children:(0,s.jsx)(r.Z,Object.assign({sx:{flexDirection:"column",height:"100%",pb:[0,0,"xs"],px:"sm"}},{children:(0,s.jsx)(g.Z,{children:({isMobile:t,isIPad:i})=>(0,s.jsxs)(s.Fragment,{children:[i?(0,s.jsx)(ii,{isMobile:t,isEmpty:N,loading:e,data:v}):(0,s.jsx)(rs,{headers:l,onCheckHeader:c,onSortHeader:u,data:v,loading:e}),"ADJUST_MARGIN"===k&&(0,s.jsx)(H,{visible:!0,position:C,onClose:z}),"ORDER_CONFIRM"===k&&(0,s.jsx)(pe,{visible:!0,position:C,onClose:z}),"TP_SL"===k&&(0,s.jsx)(Os,{visible:!0,position:C,onClose:z})]})})}))}))}))},97556:(e,t,i)=>{i.d(t,{Nu:()=>y,Qy:()=>g,zz:()=>p,PH:()=>u,Lb:()=>m,kH:()=>h,Gt:()=>x,xG:()=>d});var s=i(18101),n=i(96781),r=i(34095);const a={keys:new Set,setItem(e,t,i){if("function"!=typeof i)return new Promise((i=>{this.keys.add(e),this[e]=t,i()}));this.keys.add(e),this[e]=t,i(null)},getItem(e,t){if("function"!=typeof t)return new Promise((t=>{t(this[e])}));t(this[e])},removeItem(e,t){if("function"!=typeof t)return new Promise((t=>{this[e]=void 0,this.keys.delete(e),t()}));this[e]=void 0,this.keys.delete(e),t(null)},clear(e){if("function"!=typeof e)return new Promise((e=>{this.keys.forEach((e=>{this[e]=void 0})),this.keys.clear(),e()}));this.keys.forEach((e=>{this[e]=void 0})),this.keys.clear(),e(null)},create(){return Object.create(this)}},o={setItem(e,t,i){const s="object"==typeof t?JSON.stringify(t):t;if("function"!=typeof i)return new Promise(((t,i)=>{try{window.localStorage.setItem(e,s),t()}catch(e){i(e)}}));try{window.localStorage.setItem(e,s),i(null)}catch(e){i(e)}},getItem(e,t){if("function"!=typeof t)return new Promise((t=>{t((0,r.As)(window.localStorage.getItem(e)))}));t(null,(0,r.As)(window.localStorage.getItem(e)))},removeItem(e,t){if("function"!=typeof t)return new Promise((t=>{window.localStorage.removeItem(e),t()}));window.localStorage.removeItem(e),t(null)},clear(e){if("function"!=typeof e)return new Promise((e=>{window.localStorage.clear(),e()}));window.localStorage.clear(),e(null)},create(){return Object.create(this)}};function l(e){const t=new Map;return function(i,...s){if(t.has(i))return t.get(i);const n=e(i,...s);return t.set(i,n),n}}function c({stateKey:e,storageKey:t=e,defaultValue:i,validator:s,storage:l}){const c=void 0!==(d=l)?d:"undefined"!=typeof window?o.create():a.create();var d,u;return(0,n.Ue)((u=(t,s)=>({[e]:i,[`set${(0,r.kC)(e)}`]:i=>t({[e]:i}),[`toggle${(0,r.kC)(e)}`]:()=>t({[e]:!s()[e]})}),(n,a,o)=>{const l=u((i=>{n(i);const s=a()[e];c.setItem(t,s)}),a);let d={};return"undefined"!=typeof window&&c.getItem(t,((t,n)=>{let r;r="function"==typeof s?s(n)?n:i:null!=n?n:i,d={[e]:r}})),Object.assign(Object.assign(Object.assign({},l),d),{[`clear${(0,r.kC)(e)}`](){c.removeItem(t),n(l)}})}))}const d=(0,n.Ue)((e=>({disableMouse:!1,setDisableMouse:t=>e({disableMouse:t})}))),u=l((function(e){return c({stateKey:"miniMultiChartType",storageKey:`${e}-chart-miniMultiChartType`,defaultValue:s.k.Store.ChartMode.Single})})),m=l((function(e){return c({stateKey:"miniMultiChartWindows",storageKey:`${e}-chart-miniMultiChartWindows`,defaultValue:["","","",""]})})),p=l((function(e){return c({stateKey:"lastSelectedMiniMultiChartWindow",storageKey:`${e}-chart-lastSelectedMiniMultiChartWindow`,defaultValue:0})})),h=l((function(e){return c({stateKey:"priceType",storageKey:`${e}-chart-priceType`,defaultValue:s.k.Store.PriceType.Last})})),g=l((function(e){return c({stateKey:"interval",storageKey:`${e}-chart-interval`,defaultValue:s.k.Store.DisplayIntervals["1d"]})})),y=l((function(e){return c({stateKey:"chartType",storageKey:`${e}-chart-type`,defaultValue:s.k.Store.OriginalChartStyle.CandleBar})}));var b=i(25048);const x=(0,n.Ue)((e=>({posCalcData:{},setPosCalcData:(t,i,s)=>e((0,b.ZP)((e=>{e.posCalcData[t]||(e.posCalcData[t]={}),t&&i&&e.posCalcData[t][i]!==s&&(e.posCalcData[t][i]=s)})))})))}}]);